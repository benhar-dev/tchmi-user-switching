var TcHmi;!function(r){var e,i,a,t;function n(e,t,n){var o=a.call(this,e,t,n)||this;return o.__filterInternal=[],o.__internalColumns=[],o.__storageValidation={filter:{function:"getFilter",expectedResult:void 0},columns:{function:"getColumns",expectedResult:void 0}},o.__sortingInitialized=!1,o.__headerFontFamilyInitialized=!1,o.__headerFontSizeInitialized=!1,o.__headerFontSizeUnitInitialized=!1,o.__headerFontStyleInitialized=!1,o.__headerFontWeightInitialized=!1,o.__gridFontFamilyInitialized=!1,o.__gridFontSizeInitialized=!1,o.__gridFontSizeUnitInitialized=!1,o.__gridFontStyleInitialized=!1,o.__gridFontWeightInitialized=!1,o.__headerHeightInitialized=!1,o.__headerHeightUnitInitialized=!1,o.__rowHeightInitialized=!1,o.__typeToggles={message:null,alarm:null},o.__typeTogglesOrder=["alarm","message"],o.__severityToggles={verbose:null,info:null,warning:null,error:null,critical:null},o.__severityTogglesOrder=["verbose","info","warning","error","critical"],o.__menuBarButtons={filter:null,columns:null,confirm:null,confirmAll:null},o.__menuBarButtonsOrder=["filter","columns","confirm","confirmAll"],o.__buttonTooltips={message:"Toggle displaying of messages",alarm:"Toggle displaying of alarms",verbose:"Toggle displaying of verbose events",info:"Toggle displaying of info events",warning:"Toggle displaying of warning events",error:"Toggle displaying of error events",critical:"Toggle displaying of critical events",filter:"Configure filters",columns:"Configure displayed columns",confirm:"Confirm selected alarm",confirmAll:"Confirm all unconfirmed alarms"},o.__canConfirm=!0,o.__filterPopup=null,o.__columnsPopup=null,o.__detailsPopup=null,o.__confirmAllPopup=null,o.__typesToShow={0:!0,1:!0},o.__severitiesToShow={0:!0,1:!0,2:!0,3:!0,4:!0},o.__availableColumns={severity:{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:0,height:30,width:30,source:r.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/verbose.svg"},{text:"Info",value:1,height:30,width:30,source:r.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/info.svg"},{text:"Warning",value:2,height:30,width:30,source:r.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/warning.svg"},{text:"Error",value:3,height:30,width:30,source:r.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/error.svg"},{text:"Critical",value:4,height:30,width:30,source:r.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/critical.svg"}]},type:{name:"type",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Message",value:0,height:30,width:30,source:r.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/message.svg"},{text:"Alarm",value:1,height:30,width:30,source:r.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/alarm.svg"}]},domain:{name:"domain",label:"Domain",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},sourceDomain:{name:"sourceDomain",label:"Source Domain",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},name:{name:"name",label:"Name",control:"TextBlock",width:200,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},text:{name:"text",label:"Text",control:"TextBlock",width:373,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},alarmState:{name:"alarmState",label:"",control:"TextBlock",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateRaised:{name:"timeRaised",label:"Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeRaised:{name:"timeRaised",label:"Time Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateRaised:{name:"timeRaised",label:"Date Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateConfirmed:{name:"timeConfirmed",label:"Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeConfirmed:{name:"timeConfirmed",label:"Time Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateConfirmed:{name:"timeConfirmed",label:"Date Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateCleared:{name:"timeCleared",label:"Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeCleared:{name:"timeCleared",label:"Time Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateCleared:{name:"timeCleared",label:"Date Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"}},o.__destroyersToCallOnDetach=[],o.__serverEventConsumerDestroyer=null,o.__onUserInGroupChangedDestroyer=null,o.__doubletapStartTime=0,o.__objectResolvers=new Map,o.__consumeEventList=function(e){o.__events.clearAll(),e.error===r.Errors.NONE?e.events&&o.__events.addRange(e.events):r.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+o.getId()+"] Unable to list events: "+r.Log.buildMessage(e.details)),o.__datagrid.setSelectedRowIndex(null),o.__datagrid.setSrcData(null),o.__updateGrid(),o.__updateTypeAndSeverityCounts(),o.__updateConfirmAllButton()},o.__consumeEventSubscription=function(t){if(t.error===r.Errors.NONE){if(t.event){var e;if(t.removedByFilter){if(r.Server.Events.isAlarm(t.event))-1!==(e=o.__events.findIndex(function(e){return r.Server.Events.isAlarm(e)&&e.id===t.event.id}))&&o.__events.splice(e,1),o.__datagrid.getSelectedRowIndex()===e&&o.__datagrid.setSelectedRowIndex(null)}else if(t.changeType===r.Server.Events.ChangeType.AlarmRaised||t.changeType===r.Server.Events.ChangeType.MessageSent)o.__events.push(t.event);else-1!==(e=o.__events.findIndex(function(e){return r.Server.Events.isAlarm(e)&&r.Server.Events.isAlarm(t.event)&&e.id===t.event.id}))&&(o.__events[e]=t.event);o.__updateGrid(),o.__updateTypeAndSeverityCounts(),o.__updateConfirmAllButton()}}else r.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+o.getId()+"] Event subscription error: "+r.Log.buildMessage(t.details))},o.__onUserInGroupChanged=function(){o.__setCanConfirm(!0)},o.__onResized=function(){"Left"!==o.__menuBarPosition&&"Right"!==o.__menuBarPosition||o.__fixVerticalMenuBarWidth()},o.__onSelectedItemChanged=function(){o.__processSelectedItem(),r.EventProvider.raise(o.__id+".onFunctionResultChanged",["getSelectedEvent"]),r.EventProvider.raise(o.__id+".onSelectedItemChanged",o.getSelectedEvent())},o.__onFilterPressed=function(){o.__filterPopup||(o.__filterPopup=new i.TcHmiEventGridPopups.FilterPopup(o.__elementFilterPopup[0],o),o.__filterPopup.registerOkButtonHandler(function(){o.__filterInternal=o.__filterPopup.getSettings(),o.__processFilter(),o.__setStoredValue("filter",o.__filterInternal)})),o.__filterPopup.requiresUpdate()&&o.__filterPopup.update(o.__filterInternal),o.__filterPopup.show()},o.__onColumnsPressed=function(){o.__columnsPopup||(o.__columnsPopup=new i.TcHmiEventGridPopups.ColumnsPopup(o.__elementColumnsPopup[0],o),o.__columnsPopup.registerOkButtonHandler(function(){o.__updateColumns(o.__columnsPopup.getSettings()),o.__setStoredValue("columns",o.__internalColumns)})),o.__columnsPopup.requiresUpdate()&&o.__columnsPopup.update(o.__internalColumns),o.__columnsPopup.show()},o.__onConfirmPressed=function(){var t=o.__datagrid.getSelectedRowValue().originalEvent;r.Server.Events.isAlarm(t)&&r.Server.Events.confirmAlarm(t,function(e){e.error!==r.Errors.NONE&&r.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+o.getId()+"] Unable to confirm alarm with id "+t.id+" in domain "+t.domain+". Error: "+r.Log.buildMessage(e.details)),"object"==typeof e.details&&null!==e.details&&e.details.code===r.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&o.__setCanConfirm(!1)})},o.__onConfirmAllPressed=function(){o.__confirmAllPopup||(o.__confirmAllPopup=new i.TcHmiEventGridPopups.ConfirmAllPopup(o.__elementConfirmAllPopup[0],o)),o.__confirmAllPopup.update(o.__events.filter(function(e){return r.Server.Events.isAlarm(e)&&e.confirmationState===r.Server.Events.ConfirmationState.WaitForConfirmation})),o.__confirmAllPopup.show()},o.__onDoubleclick=function(e){if(o.getIsEnabled()&&r.Access.checkAccess(o,"operate")&&r.Access.checkAccess(o,"viewDetails")&&e.target instanceof Element){for(var t=e.target;t&&!t.classList.contains("tchmi-datagrid-template-row");)t=t.parentElement;t&&(r.EventProvider.raise(o.__id+".onItemDoubleClicked",o.getSelectedEvent()),o.__showDetails())}},o.__onTouchStart=function(e){if(o.getIsEnabled()&&r.Access.checkAccess(o,"operate")&&r.Access.checkAccess(o,"viewDetails")&&e.target instanceof Element){for(var t=e.target;t&&!t.classList.contains("tchmi-datagrid-template-row");)t=t.parentElement;var n=Date.now();t&&(n-o.__doubletapStartTime<300?(r.EventProvider.raise(o.__id+".onItemDoubleClicked",o.getSelectedEvent()),o.__showDetails(),o.__doubletapStartTime=0,e.preventDefault()):o.__doubletapStartTime=n)}},o.__onScroll=function(e){o.getIsEnabled()&&r.Access.checkAccess(o,"operate")&&r.Access.checkAccess(o,"viewDetails")&&(o.__doubletapStartTime=0)},o.__onResolverForColumnsWatchCallback=function(e){!1===o.__isAttached&&e.destroy&&e.destroy(),tchmi_equal(e.value,o.__columns)||(o.__columns=e.value,r.EventProvider.raise(o.__id+".onFunctionResultChanged",["getColumns"]),o.__processColumns())},o.__onResolverForFilterWatchCallback=function(e){!1===o.__isAttached&&e.destroy&&e.destroy(),tchmi_equal(e.value,o.__filter)||(o.__filter=e.value,o.__filterInternal=e.value||[],r.EventProvider.raise(o.__id+".onFunctionResultChanged",["getFilter"]),o.__processFilter())},o.__onDatagridFunctionResultChanged=function(e,t){var n=["getSorting","getHeaderFontFamily","getHeaderFontSize","getHeaderFontSizeUnit","getHeaderFontStyle","getHeaderFontWeight","getGridFontFamily","getGridFontSize","getGridFontSizeUnit","getGridFontStyle","getGridFontWeight","getHeaderHeight","getHeaderHeightUnit","getRowHeight"],i=t.filter(function(e){return-1!==n.indexOf(e)});0<i.length&&r.EventProvider.raise(o.__id+".onFunctionResultChanged",i)},o.__events=new r.List,o}e=r.Controls||(r.Controls={}),i=e.Beckhoff||(e.Beckhoff={}),a=r.Controls.System.TcHmiControl,__extends(n,a),n.prototype.__previnit=function(){if(this.__elementTemplateRoot=this.__element.find(".tchmi-event-grid-template"),this.__elementGridContainer=this.__elementTemplateRoot.find(".tchmi-event-grid-template-grid-container"),this.__elementMenuBar=this.__elementTemplateRoot.find(".tchmi-event-grid-template-menu-bar"),this.__elementTypeToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-type-toggles"),this.__elementSeverityToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-severity-toggles"),this.__elementOptions=this.__elementMenuBar.find(".tchmi-event-grid-template-options"),this.__elementMessageActions=this.__elementMenuBar.find(".tchmi-event-grid-template-event-actions"),this.__elementFilterPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-filter-popup"),this.__elementColumnsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-columns-popup"),this.__elementDetailsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-details-popup"),this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-confirm-all-popup"),0===this.__elementTemplateRoot.length||0===this.__elementGridContainer.length||0===this.__elementMenuBar.length||0===this.__elementTypeToggles.length||0===this.__elementSeverityToggles.length||0===this.__elementOptions.length||0===this.__elementMessageActions.length||0===this.__elementFilterPopup.length||0===this.__elementColumnsPopup.length||0===this.__elementDetailsPopup.length||0===this.__elementConfirmAllPopup.length)throw new Error("Invalid Template.html");var e=r.ControlFactory.createEx("tchmi-datagrid",this.__id+".eventDatagrid",{"data-tchmi-width":100,"data-tchmi-width-unit":"%","data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-row-classes-provider":{objectType:"Function",active:!0,fn:"AlarmStateClassesProvider",fnParams:[]}},this);if(!e)throw new Error("Could not create controls for TcHmiEventGrid.");this.__datagrid=e,this.__destroyersToCallOnDetach.push(r.EventProvider.register(e.getId()+".onFunctionResultChanged",this.__onDatagridFunctionResultChanged)),a.prototype.__previnit.call(this)},n.prototype.__init=function(){a.prototype.__init.call(this),this.__initStorage(),this.__onUserInGroupChangedDestroyer=r.EventProvider.register("onUserInGroupChanged",this.__onUserInGroupChanged),this.__processColumns(),this.__elementGridContainer.append(this.__datagrid.getElement());for(var e=0,t=this.__typeTogglesOrder.length;e<t;e++){var n=this.__typeTogglesOrder[e];if(this.__typeToggles.hasOwnProperty(n)){if(!(i=r.ControlFactory.createEx("tchmi-toggle-button",this.__id+"."+n+"ToggleButton",{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[n],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight},this)))throw new Error("Could not create controls for TcHmiEventGrid.");(o=i.getElement()).addClass("tchmi-event-grid-template-"+n.toLowerCase()+"-toggle-button"),this.__typeToggles[n]=i,this.__elementTypeToggles.append(o)}}for(e=0,t=this.__severityTogglesOrder.length;e<t;e++)if(n=this.__severityTogglesOrder[e],this.__severityToggles.hasOwnProperty(n)){if(!(i=r.ControlFactory.createEx("tchmi-toggle-button",this.__id+"."+n+"ToggleButton",{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[n],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight},this)))throw new Error("Could not create controls for TcHmiEventGrid.");(o=i.getElement()).addClass("tchmi-event-grid-template-"+n.toLowerCase()+"-toggle-button"),this.__severityToggles[n]=i,this.__elementSeverityToggles.append(o)}for(e=0,t=this.__menuBarButtonsOrder.length;e<t;e++)if(n=this.__menuBarButtonsOrder[e],this.__menuBarButtons.hasOwnProperty(n)){var i,o;if(!(i=r.ControlFactory.createEx("tchmi-button",this.__id+"."+n+"Button",{"data-tchmi-width":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-tooltip":this.__buttonTooltips[n]},this)))throw new Error("Could not create controls for TcHmiEventGrid.");(o=i.getElement()).addClass("tchmi-event-grid-template-"+n.toLowerCase()+"-button"),this.__menuBarButtons[n]=i,"confirm"===n||"confirmAll"===n?(i.setIsEnabled(!1),this.__elementMessageActions.append(o)):this.__elementOptions.append(o)}this.__menuBarButtons.columns&&this.__menuBarButtons.columns.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"configure"}])},n.prototype.__attach=function(){for(var e in a.prototype.__attach.call(this),this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__id+".onResized",this.__onResized)),this.__typeToggles)if(this.__typeToggles.hasOwnProperty(e)){var t=r.Server.Events.Type[e.substr(0,1).toUpperCase()+e.substr(1)];this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__typeToggles[e].getId()+".onToggleStateChanged",this.__onTypeToggleStateChanged(this.__typeToggles[e],t)))}for(var e in this.__severityToggles)if(this.__severityToggles.hasOwnProperty(e)){var n=r.Server.Events.Severity[e.substr(0,1).toUpperCase()+e.substr(1)];this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__severityToggles[e].getId()+".onToggleStateChanged",this.__onSeverityToggleStateChanged(this.__severityToggles[e],n)))}this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__datagrid.getId()+".onSelectedItemChanged",this.__onSelectedItemChanged)),this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__menuBarButtons.filter.getId()+".onPressed",this.__onFilterPressed)),this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__menuBarButtons.columns.getId()+".onPressed",this.__onColumnsPressed)),this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__menuBarButtons.confirm.getId()+".onPressed",this.__onConfirmPressed)),this.__destroyersToCallOnDetach.push(r.EventProvider.register(this.__menuBarButtons.confirmAll.getId()+".onPressed",this.__onConfirmAllPressed)),this.__elementGridContainer[0].addEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].addEventListener("touchstart",this.__onTouchStart),this.__elementGridContainer[0].addEventListener("scroll",this.__onScroll,!0);var i=this.__getStoredValue("filter");i&&(this.__filterInternal=i),this.__processFilter();var o=this.__getStoredValue("columns");o&&this.__updateColumns(o),this.__objectResolvers.forEach(function(e){return e.resolver.watch(e.watchCallback)})},n.prototype.__detach=function(){a.prototype.__detach.call(this);for(var e=0,t=this.__destroyersToCallOnDetach.length;e<t;e++)this.__destroyersToCallOnDetach[e]();this.__destroyersToCallOnDetach=[],this.__serverEventConsumerDestroyer&&(this.__serverEventConsumerDestroyer(),this.__serverEventConsumerDestroyer=null),this.__elementGridContainer[0].removeEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].removeEventListener("touchstart",this.__onTouchStart),this.__elementGridContainer[0].removeEventListener("scroll",this.__onScroll),this.__events.clearAll(),this.__datagrid.setSrcData(null),this.__objectResolvers.forEach(function(e){e.watchDestroyer&&(e.watchDestroyer(),e.watchDestroyer=null)})},n.prototype.destroy=function(){a.prototype.destroy.call(this),this.__onUserInGroupChangedDestroyer&&(this.__onUserInGroupChangedDestroyer(),this.__onUserInGroupChangedDestroyer=null),this.__filterPopup&&(this.__filterPopup.destroy(),this.__filterPopup=null),this.__columnsPopup&&(this.__columnsPopup.destroy(),this.__columnsPopup=null),this.__detailsPopup&&(this.__detailsPopup.destroy(),this.__detailsPopup=null),this.__confirmAllPopup&&(this.__confirmAllPopup.destroy(),this.__confirmAllPopup=null),this.__objectResolvers.forEach(function(e){e.watchDestroyer&&e.watchDestroyer(),e.resolver.destroy()}),this.__objectResolvers.clear()},n.prototype.__onTypeToggleStateChanged=function(e,t){var n=this;return function(){n.__typesToShow[t]="Active"===e.getToggleState(),n.__updateGrid()}},n.prototype.__onSeverityToggleStateChanged=function(e,t){var n=this;return function(){n.__severitiesToShow[t]="Active"===e.getToggleState(),n.__updateGrid()}},n.prototype.__showDetails=function(){this.__allowDetailsPopup&&(this.__detailsPopup||(this.__detailsPopup=new i.TcHmiEventGridPopups.DetailsPopup(this.__elementDetailsPopup[0],this)),this.__detailsPopup.update(this.__datagrid.getSelectedRowValue()),this.__detailsPopup.show())},n.prototype.__processSelectedItem=function(){var e=this.__datagrid.getSelectedRowValue();if(null===e)this.__menuBarButtons.confirm.setIsEnabled(!1),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.hide();else{var t=e.originalEvent;this.__menuBarButtons.confirm.setIsEnabled(r.Server.Events.isAlarm(t)&&t.confirmationState===r.Server.Events.ConfirmationState.WaitForConfirmation),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.update(e)}},n.prototype.__updateGrid=function(){var t=this;if(null!==this.__datagrid){var e=this.__events.filter(function(e){return t.__severitiesToShow[e.severity]&&t.__typesToShow[e.type]}).map(function(e){return t.__toEventDisplay(e)});this.__datagrid.setSrcData(e),this.__processSelectedItem()}},n.prototype.__toEventDisplay=function(e){var t={type:e.type,severity:e.severity,domain:e.domain,sourceDomain:e.sourceDomain,name:e.name,text:e.text,timeRaised:e.timeRaised,params:e.params,originalEvent:e};return r.Server.Events.isAlarm(e)&&(t.alarmState=e.alarmState,t.id=e.id,t.timeCleared=0===e.timeCleared.getTime()?null:e.timeCleared,t.timeConfirmed=0===e.timeConfirmed.getTime()?null:e.timeConfirmed),t},n.prototype.__updateTypeAndSeverityCounts=function(){for(var e=this.__events.reduce(function(e,t){return e[t.type]++,e},[0,0]),t=0,n=e.length;t<n;t++)this.__typeToggles[r.Server.Events.Type[t].toLowerCase()].setText(e[t].toString());var i=this.__events.reduce(function(e,t){return e[t.severity]++,e},[0,0,0,0,0]);for(t=0,n=i.length;t<n;t++)this.__severityToggles[r.Server.Events.Severity[t].toLowerCase()].setText(i[t].toString())},n.prototype.__updateConfirmAllButton=function(){if(this.__menuBarButtons.confirmAll){var e=this.__events.reduce(function(e,t){return r.Server.Events.isAlarm(t)&&t.confirmationState===r.Server.Events.ConfirmationState.WaitForConfirmation&&e++,e},0);this.__menuBarButtons.confirmAll.setIsEnabled(0<e)}},n.prototype.__initStorage=function(){var e=window.localStorage.getItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id);if(e)try{this.__storage=JSON.parse(e),"object"!=typeof this.__storage&&(this.__storage={})}catch(e){this.__storage={}}else this.__storage={};for(var t in this.__storageValidation)this.__storageValidation[t].expectedResult=this[this.__storageValidation[t].function].apply(this);for(var t in this.__storage)tchmi_equal(this.__storageValidation[t].expectedResult,this.__storage[t].validation.expectedResult)||this.__removeStoredValue(t)},n.prototype.__getStoredValue=function(e){this.__storage||this.__initStorage();var t=r.Server.getCurrentUser(),n=this.__storage[e];if(n)return t?n.users?n.users[t]:void 0:n.anonymousUser},n.prototype.__setStoredValue=function(e,t){this.__storage||this.__initStorage();var n=r.Server.getCurrentUser();this.__storage[e]||(this.__storage[e]={validation:{function:this.__storageValidation[e].function,expectedResult:this.__storageValidation[e].expectedResult}});var i=this.__storage[e];n?(i.users||(i.users={}),i.users[n]=t):i.anonymousUser=t;try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(e){}},n.prototype.__removeStoredValue=function(e){this.__storage||this.__initStorage();var t=this.__storage[e];if(t){var n=r.Server.getCurrentUser();n?t.users?(delete t.users[n],0===Object.keys(t.users).length&&(void 0===t.anonymousUser?delete this.__storage[e]:delete t.users)):void 0===t.anonymousUser&&delete this.__storage[e]:t.users?delete t.anonymousUser:delete this.__storage[e]}if(0<Object.keys(this.__storage).length)try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(e){}else window.localStorage.removeItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id)},n.prototype.setColumns=function(e){var t=r.ValueConverter.toObject(e);null===t&&(t=this.getAttributeDefaultValueInternal("Columns"));var n=this.__objectResolvers.get("columns");n&&(n.watchDestroyer&&n.watchDestroyer(),n.resolver.destroy());var i=new r.Symbol.ObjectResolver(t);this.__objectResolvers.set("columns",{resolver:i,watchCallback:this.__onResolverForColumnsWatchCallback,watchDestroyer:i.watch(this.__onResolverForColumnsWatchCallback)})},n.prototype.getColumns=function(){return this.__columns},n.prototype.__processColumns=function(){this.__columns?this.__updateColumns(this.__columns):this.__updateColumns([])},n.prototype.__updateColumns=function(e){var n=this;if(this.__internalColumns=e,this.__datagrid){var t=e.map(function(e){var t;return(t=n.__availableColumns[e.columnName]?tchmi_clone_object(n.__availableColumns[e.columnName]):{name:e.columnName,label:void 0!==e.label&&null!==e.label?e.label:e.columnName,control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:50,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"})&&void 0!==e.width&&null!==e.width&&(t.width=e.width,e.widthUnit&&(t.widthUnit=e.widthUnit)),t}).filter(function(e){return void 0!==e});this.__datagrid.setSrcColumn(t)}},n.prototype.setFilter=function(e){var t=r.ValueConverter.toObject(e);null===t&&(t=this.getAttributeDefaultValueInternal("Filter"));var n=this.__objectResolvers.get("filter");n&&(n.watchDestroyer&&n.watchDestroyer(),n.resolver.destroy());var i=new r.Symbol.ObjectResolver(t);this.__objectResolvers.set("filter",{resolver:i,watchCallback:this.__onResolverForFilterWatchCallback,watchDestroyer:i.watch(this.__onResolverForFilterWatchCallback)})},n.prototype.getFilter=function(){return this.__filter},n.prototype.__processFilter=function(){this.__serverEventConsumerDestroyer&&this.__serverEventConsumerDestroyer(),!TCHMI_ENABLE_DESIGNER_MODE_MASTER&&this.__isAttached&&(this.__serverEventConsumerDestroyer=r.Server.Events.registerConsumer(this.__filterInternal,{list:this.__consumeEventList,subscription:this.__consumeEventSubscription}))},n.prototype.setSorting=function(e){this.__datagrid.setSorting(e),this.__sortingInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getSorting"]),this.__sortingInitialized=!0)},n.prototype.getSorting=function(){return this.__sortingInitialized?this.__datagrid.getSorting():void 0},n.prototype.setHeaderFontFamily=function(e){this.__datagrid.setHeaderFontFamily(e),this.__headerFontFamilyInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontFamily"]),this.__headerFontFamilyInitialized=!0)},n.prototype.getHeaderFontFamily=function(){return this.__headerFontFamilyInitialized?this.__datagrid.getHeaderFontFamily():void 0},n.prototype.setHeaderFontSize=function(e){this.__datagrid.setHeaderFontSize(e),this.__headerFontSizeInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontSize"]),this.__headerFontSizeInitialized=!0)},n.prototype.getHeaderFontSize=function(){return this.__headerFontSizeInitialized?this.__datagrid.getHeaderFontSize():void 0},n.prototype.setHeaderFontSizeUnit=function(e){this.__datagrid.setHeaderFontSizeUnit(e),this.__headerFontSizeUnitInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontSizeUnit"]),this.__headerFontSizeUnitInitialized=!0)},n.prototype.getHeaderFontSizeUnit=function(){return this.__headerFontSizeUnitInitialized?this.__datagrid.getHeaderFontSizeUnit():void 0},n.prototype.setHeaderFontStyle=function(e){this.__datagrid.setHeaderFontStyle(e),this.__headerFontStyleInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontStyle"]),this.__headerFontStyleInitialized=!0)},n.prototype.getHeaderFontStyle=function(){return this.__headerFontStyleInitialized?this.__datagrid.getHeaderFontStyle():void 0},n.prototype.setHeaderFontWeight=function(e){this.__datagrid.setHeaderFontWeight(e),this.__headerFontWeightInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderFontWeight"]),this.__headerFontWeightInitialized=!0)},n.prototype.getHeaderFontWeight=function(){return this.__headerFontWeightInitialized?this.__datagrid.getHeaderFontWeight():void 0},n.prototype.setGridFontFamily=function(e){this.__datagrid.setGridFontFamily(e),this.__datagrid.setRowNumbersFontFamily(e),this.__gridFontFamilyInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontFamily"]),this.__gridFontFamilyInitialized=!0)},n.prototype.getGridFontFamily=function(){return this.__gridFontFamilyInitialized?this.__datagrid.getGridFontFamily():void 0},n.prototype.setGridFontSize=function(e){this.__datagrid.setGridFontSize(e),this.__datagrid.setRowNumbersFontSize(e),this.__gridFontSizeInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontSize"]),this.__gridFontSizeInitialized=!0)},n.prototype.getGridFontSize=function(){return this.__gridFontSizeInitialized?this.__datagrid.getGridFontSize():void 0},n.prototype.setGridFontSizeUnit=function(e){this.__datagrid.setGridFontSizeUnit(e),this.__datagrid.setRowNumbersFontSizeUnit(e),this.__gridFontSizeUnitInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontSizeUnit"]),this.__gridFontSizeUnitInitialized=!0)},n.prototype.getGridFontSizeUnit=function(){return this.__gridFontSizeUnitInitialized?this.__datagrid.getGridFontSizeUnit():void 0},n.prototype.setGridFontStyle=function(e){this.__datagrid.setGridFontStyle(e),this.__datagrid.setRowNumbersFontStyle(e),this.__gridFontStyleInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontStyle"]),this.__gridFontStyleInitialized=!0)},n.prototype.getGridFontStyle=function(){return this.__gridFontStyleInitialized?this.__datagrid.getGridFontStyle():void 0},n.prototype.setGridFontWeight=function(e){this.__datagrid.setGridFontWeight(e),this.__datagrid.setRowNumbersFontWeight(e),this.__gridFontWeightInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getGridFontWeight"]),this.__gridFontWeightInitialized=!0)},n.prototype.getGridFontWeight=function(){return this.__gridFontWeightInitialized?this.__datagrid.getGridFontWeight():void 0},n.prototype.setHeaderHeight=function(e){this.__datagrid.setHeaderHeight(e),this.__headerHeightInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderHeight"]),this.__headerHeightInitialized=!0)},n.prototype.getHeaderHeight=function(){return this.__headerHeightInitialized?this.__datagrid.getHeaderHeight():void 0},n.prototype.setHeaderHeightUnit=function(e){this.__datagrid.setHeaderHeightUnit(e),this.__headerHeightUnitInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeaderHeightUnit"]),this.__headerHeightUnitInitialized=!0)},n.prototype.getHeaderHeightUnit=function(){return this.__headerHeightUnitInitialized?this.__datagrid.getHeaderHeightUnit():void 0},n.prototype.setRowHeight=function(e){this.__datagrid.setRowHeight(e),this.__rowHeightInitialized||(r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getRowHeight"]),this.__rowHeightInitialized=!0)},n.prototype.getRowHeight=function(){return this.__rowHeightInitialized?this.__datagrid.getRowHeight():void 0},n.prototype.getRowHeightUnit=function(){return"px"},n.prototype.setAllowDetailsPopup=function(e){var t=r.ValueConverter.toBoolean(e);null===t&&(t=this.getAttributeDefaultValueInternal("AllowDetailsPopup")),t!==this.__allowDetailsPopup&&(this.__allowDetailsPopup=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getAllowDetailsPopup"]),this.__processAllowDetailsPopup())},n.prototype.getAllowDetailsPopup=function(){return this.__allowDetailsPopup},n.prototype.__processAllowDetailsPopup=function(){},n.prototype.setShowMenuBar=function(e){var t=r.ValueConverter.toBoolean(e);null===t&&(t=this.getAttributeDefaultValueInternal("ShowMenuBar")),t!==this.__showMenuBar&&(this.__showMenuBar=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getShowMenuBar"]),this.__processShowMenuBar())},n.prototype.getShowMenuBar=function(){return this.__showMenuBar},n.prototype.__processShowMenuBar=function(){this.__showMenuBar?(r.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display",null),this.__fixVerticalMenuBarWidth()):r.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display","none")},n.prototype.setMenuBarPosition=function(e){var t=r.ValueConverter.toString(e);(null===t||"Top"!==t&&"Bottom"!==t&&"Left"!==t&&"Right"!==t)&&(t=this.getAttributeDefaultValueInternal("MenuBarPosition")),t!==this.__menuBarPosition&&(this.__menuBarPosition=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getMenuBarPosition"]),this.__processMenuBarPosition())},n.prototype.getMenuBarPosition=function(){return this.__menuBarPosition},n.prototype.__processMenuBarPosition=function(){switch(this.__menuBarPosition){case"Top":r.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction",null),r.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Bottom":r.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","column-reverse"),r.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Left":r.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row"),r.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column");break;case"Right":r.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row-reverse"),r.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column")}this.__fixVerticalMenuBarWidth()},n.prototype.setButtonFontFamily=function(e){var t=r.ValueConverter.toString(e);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontFamily")),t!==this.__buttonFontFamily&&(this.__buttonFontFamily=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontFamily"]),this.__processButtonFontFamily())},n.prototype.getButtonFontFamily=function(){return this.__buttonFontFamily},n.prototype.__processButtonFontFamily=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontFamily(this.__buttonFontFamily);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontFamily(this.__buttonFontFamily)},n.prototype.setButtonFontSize=function(e){var t=r.ValueConverter.toNumber(e);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontSize")),t!==this.__buttonFontSize&&(this.__buttonFontSize=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontSize"]),this.__processButtonFontSize())},n.prototype.getButtonFontSize=function(){return this.__buttonFontSize},n.prototype.__processButtonFontSize=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontSize(this.__buttonFontSize);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontSize(this.__buttonFontSize)},n.prototype.setButtonFontSizeUnit=function(e){var t=r.ValueConverter.toDimensionUnit(e);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontSizeUnit")),t!==this.__buttonFontSizeUnit&&(this.__buttonFontSizeUnit=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontSizeUnit"]),this.__processButtonFontSizeUnit())},n.prototype.getButtonFontSizeUnit=function(){return this.__buttonFontSizeUnit},n.prototype.__processButtonFontSizeUnit=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontSizeUnit(this.__buttonFontSizeUnit);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontSizeUnit(this.__buttonFontSizeUnit)},n.prototype.setButtonFontStyle=function(e){var t=r.ValueConverter.toFontStyle(e);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontStyle")),t!==this.__buttonFontStyle&&(this.__buttonFontStyle=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontStyle"]),this.__processButtonFontStyle())},n.prototype.getButtonFontStyle=function(){return this.__buttonFontStyle},n.prototype.__processButtonFontStyle=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontStyle(this.__buttonFontStyle);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontStyle(this.__buttonFontStyle)},n.prototype.setButtonFontWeight=function(e){var t=r.ValueConverter.toFontWeight(e);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontWeight")),t!==this.__buttonFontWeight&&(this.__buttonFontWeight=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonFontWeight"]),this.__processButtonFontWeight())},n.prototype.getButtonFontWeight=function(){return this.__buttonFontWeight},n.prototype.__processButtonFontWeight=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&this.__typeToggles[e].setTextFontWeight(this.__buttonFontWeight);for(var e in this.__severityToggles)this.__severityToggles[e]&&this.__severityToggles[e].setTextFontWeight(this.__buttonFontWeight)},n.prototype.setButtonHeight=function(e){var t=r.ValueConverter.toNumber(e);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonHeight")),t!==this.__buttonHeight&&(this.__buttonHeight=t,r.EventProvider.raise(this.__id+".onFunctionResultChanged",["getButtonHeight"]),this.__processButtonHeight())},n.prototype.getButtonHeight=function(){return this.__buttonHeight},n.prototype.__processButtonHeight=function(){for(var e in this.__typeToggles)this.__typeToggles[e]&&(this.__typeToggles[e].setHeight(this.__buttonHeight),this.__typeToggles[e].setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(var e in this.__severityToggles)this.__severityToggles[e]&&(this.__severityToggles[e].setHeight(this.__buttonHeight),this.__severityToggles[e].setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(var e in this.__menuBarButtons)this.__menuBarButtons[e]&&(this.__menuBarButtons[e].setHeight(this.__buttonHeight),this.__menuBarButtons[e].setWidth(this.__buttonHeight));this.__fixVerticalMenuBarWidth()},n.prototype.getButtonHeightUnit=function(){return"px"},n.prototype.__fixVerticalMenuBarWidth=function(){var e=this.__elementMenuBar.add(this.__elementMenuBar.children());if(r.StyleProvider.setSimpleElementStyle(e,"min-width",null),"Left"===this.__menuBarPosition||"Right"===this.__menuBarPosition)for(var t=e.length-1;0<=t;t--){var n=e[t].lastElementChild;if(n){var i=n.getBoundingClientRect().right-e[t].getBoundingClientRect().left;r.StyleProvider.setSimpleElementStyle(e[t],"min-width",i+"px")}}},n.prototype.getSelectedEvent=function(){if(!this.__datagrid)return null;var e=this.__datagrid.getSelectedRowValue();return e&&e.originalEvent?e.originalEvent:null},n.prototype.__processIsEnabled=function(){a.prototype.__processIsEnabled.call(this),this.__isEnabled||this.__hideAllPopups()},n.prototype.__processAccessConfig=function(){a.prototype.__processAccessConfig.call(this),!1!==r.Access.checkAccess(this,"operate")&&!1!==r.Access.checkAccess(this,"observe")||this.__hideAllPopups(),r.Access.checkAccess(this,"configure")||(this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide()),r.Access.checkAccess(this,"viewDetails")||this.__detailsPopup&&this.__detailsPopup.hide()},n.prototype.__hideAllPopups=function(){this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide(),this.__detailsPopup&&this.__detailsPopup.hide(),this.__confirmAllPopup&&this.__confirmAllPopup.hide()},n.prototype.__setCanConfirm=function(e){this.__canConfirm=e,this.__detailsPopup&&this.__detailsPopup.__setCanConfirm(e),this.__menuBarButtons.confirm.getElement().toggleClass("tchmi-control-operate-disallowed",!e),this.__menuBarButtons.confirmAll.getElement().toggleClass("tchmi-control-operate-disallowed",!e),this.__menuBarButtons.confirm.setIsEnabled(e),this.__menuBarButtons.confirmAll.setIsEnabled(e)},n.prototype.__getCanConfirm=function(){return this.__canConfirm},t=n,i.TcHmiEventGrid=t,e.register("tchmi-event-grid",r.Controls.Beckhoff.TcHmiEventGrid,"Beckhoff/TcHmiEventGrid/","Beckhoff/TcHmiEventGrid/Template.html")}(TcHmi=TcHmi||{}),function(t){var e,n,i,o;function r(e,t,n){if(this.__eventDestroyers=[],this.__isShowing=!1,this.__name=t,this.__parentControl=n,this.__element=e,this.__elementContent=e.getElementsByClassName("tchmi-event-grid-template-popup-content")[0],this.__elementFooter=e.getElementsByClassName("tchmi-event-grid-template-popup-footer")[0],!this.__element||!this.__elementContent||!this.__elementFooter)throw new Error("Invalid Template.html")}e=t.Controls||(t.Controls={}),n=e.Beckhoff||(e.Beckhoff={}),i=n.TcHmiEventGridPopups||(n.TcHmiEventGridPopups={}),r.prototype.show=function(){var e=this;this.__isShowing||(t.TopMostLayer.add(this.__parentControl,$(this.__element),{removeCb:function(){return e.__isShowing=!1},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)},r.prototype.hide=function(){this.__isShowing&&(t.TopMostLayer.remove(this.__parentControl,$(this.__element)),this.__isShowing=!1)},r.prototype.destroy=function(){for(var e=0,t=this.__eventDestroyers.length;e<t;e++)this.__eventDestroyers[e]()},r.prototype.isShowing=function(){return this.__isShowing},o=r,i.Popup=o}(TcHmi=TcHmi||{}),function(a){var e,t,n,l,i;function o(e,t,n){var i=l.call(this,e,t,n)||this;i.__okHandlers=[],i.__cancelHandlers=[],i.__updateRequired=!0;var o=a.ControlFactory.createEx("tchmi-button",i.__parentControl.getId()+"."+i.__name+".okButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"OK","data-tchmi-tooltip":"Save and apply changes and close the popup"},i.__parentControl),r=a.ControlFactory.createEx("tchmi-button",i.__parentControl.getId()+"."+i.__name+".cancelButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Cancel","data-tchmi-tooltip":"Discard changes and close the popup"},i.__parentControl);if(!o||!r)throw new Error("Could not create controls for SettingsPopup.");return i.__elementFooter.appendChild(o.getElement()[0]),i.__eventDestroyers.push(a.EventProvider.register(o.getId()+".onPressed",function(){i.__onOkPressed()})),i.__elementFooter.appendChild(r.getElement()[0]),i.__eventDestroyers.push(a.EventProvider.register(r.getId()+".onPressed",function(){i.__onCancelPressed()})),i}e=a.Controls||(a.Controls={}),t=e.Beckhoff||(e.Beckhoff={}),n=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}),l=n.Popup,__extends(o,l),o.prototype.__onOkPressed=function(){for(var e=this.__updateRequired=!0,t=0,n=this.__okHandlers.length;t<n;t++)!1===this.__okHandlers[t]()&&(e=!1);return e&&this.hide(),e},o.prototype.__onCancelPressed=function(){for(var e=this.__updateRequired=!0,t=0,n=this.__cancelHandlers.length;t<n;t++)!1===this.__cancelHandlers[t]()&&(e=!1);return e&&this.hide(),e},o.prototype.registerOkButtonHandler=function(e){var t=this;return this.__okHandlers.push(e),function(){t.__okHandlers.splice(t.__okHandlers.indexOf(e),1)}},o.prototype.registerCancelButtonHandler=function(e){var t=this;return this.__cancelHandlers.push(e),function(){t.__cancelHandlers.splice(t.__okHandlers.indexOf(e),1)}},o.prototype.update=function(e){this.__settings=tchmi_clone_object(e),this.__updateRequired=!1},o.prototype.getSettings=function(){return this.__settings},o.prototype.requiresUpdate=function(){return this.__updateRequired},i=o,n.SettingsPopup=i}(TcHmi=TcHmi||{}),function(u){var e,t,n,p,i;function o(e,t){var a=p.call(this,e,"columnsPopup",t)||this;a.__settings=[],a.__availableColumns=new u.List,a.__selectedColumns=new u.List,a.__columns={type:{label:"Type",order:0},severity:{label:"Severity",order:1},alarmState:{label:"Alarm state",order:2},domain:{label:"Domain",order:3},sourceDomain:{label:"Source Domain",order:4},name:{label:"Name",order:5},text:{label:"Text",order:6},timeAndDateRaised:{label:"Time and date raised",order:7},timeRaised:{label:"Time raised",order:8},dateRaised:{label:"Date raised",order:9},timeAndDateConfirmed:{label:"Time and date confirmed",order:10},timeConfirmed:{label:"Time confirmed",order:11},dateConfirmed:{label:"Date confirmed",order:12},timeAndDateCleared:{label:"Time and date cleared",order:13},timeCleared:{label:"Time cleared",order:14},dateCleared:{label:"Date cleared",order:15},"params::":{label:"params::",order:16}},a.__activeElement=null,a.__activeColumn=null,a.__onAvailableColumnClick=function(e){var t=e.target;if(t.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){var n=t.parentElement,i=a.__availableColumns.findIndex(function(e){return e.element===n});if(-1===i)return;0!==a.__availableColumns[i].name.indexOf("params::")?(a.__settings.push({columnName:a.__availableColumns[i].name}),a.__elementSelectedColumns.appendChild(a.__availableColumns[i].element),a.__selectedColumns.push(a.__availableColumns[i]),a.__availableColumns.splice(i,1)):(a.__settings.push({columnName:"params::"}),n=a.__createColumnDiv("params::"),a.__elementSelectedColumns.appendChild(n),a.__selectedColumns.push({name:"params::",element:n})),a.__activateColumn(n)}},a.__onSelectedColumnClick=function(e){var t=e.target;if(t.classList.contains("tchmi-event-grid-template-columns-config-column"))a.__activateColumn(t);else if(t.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){var n=t.parentElement,i=a.__selectedColumns.findIndex(function(e){return e.element===n});if(-1===i)return;a.__settings.splice(i,1);var o=a.__selectedColumns[i];if(a.__selectedColumns.splice(i,1),0!==o.name.indexOf("params::")){a.__availableColumns.push(o),a.__availableColumns.sort(function(e,t){return a.__columns[e.name].order-a.__columns[t.name].order});var r=a.__availableColumns.indexOf(o);-1===r||r>=a.__elementAvailableColumns.children.length?a.__elementAvailableColumns.appendChild(o.element):a.__elementAvailableColumns.insertBefore(o.element,a.__elementAvailableColumns.children[r])}else a.__elementSelectedColumns.removeChild(o.element);a.__activateColumn(null)}},a.__onUpPressed=function(){var e=a.__selectedColumns.findIndex(function(e){return e.element===a.__activeElement});if(-1!==e&&0!==e){var t=a.__settings[e];a.__settings[e]=a.__settings[e-1],a.__settings[e-1]=t;var n=a.__selectedColumns[e];a.__selectedColumns[e]=a.__selectedColumns[e-1],a.__selectedColumns[e-1]=n,a.__activeElement&&a.__activeElement.previousElementSibling&&a.__activeElement.previousElementSibling.insertAdjacentElement("beforebegin",a.__activeElement),a.__updateButtons()}},a.__onDownPressed=function(){var e=a.__selectedColumns.findIndex(function(e){return e.element===a.__activeElement});if(-1!==e&&e!==a.__settings.length-1){var t=a.__settings[e];a.__settings[e]=a.__settings[e+1],a.__settings[e+1]=t;var n=a.__selectedColumns[e];a.__selectedColumns[e]=a.__selectedColumns[e+1],a.__selectedColumns[e+1]=n,a.__activeElement&&a.__activeElement.nextElementSibling&&a.__activeElement.nextElementSibling.insertAdjacentElement("afterend",a.__activeElement),a.__updateButtons()}},a.__onWidthChanged=function(){var e=a.__widthTextbox.getText();if(!e)return a.__widthTextbox.setBackgroundColor(null),void(a.__activeColumn&&void 0!==a.__activeColumn.width&&null!==a.__activeColumn.width&&(delete a.__activeColumn.width,delete a.__activeColumn.widthUnit));var t=parseFloat(e);if(!isNaN(t)&&/^[+-]?\d*\.?\d+(?:[eE][+-]\d+)?$/.test(e)){if(a.__widthTextbox.setBackgroundColor(null),a.__activeColumn&&(a.__activeColumn.width=t,!a.__activeColumn.widthUnit)){var n=a.__widthUnitCombobox.getSelectedValue();n?a.__activeColumn.widthUnit=n:a.__widthUnitCombobox.setSelectedIndex(0)}}else a.__widthTextbox.setBackgroundColor({color:"rgba(255, 0, 0, 1)"})},a.__onWidthUnitChanged=function(){if(a.__activeColumn){var e=a.__widthUnitCombobox.getSelectedValue();e?void 0!==a.__activeColumn.width&&(a.__activeColumn.widthUnit=e):delete a.__activeColumn.widthUnit}},a.__onNameChanged=function(){if(a.__activeColumn&&a.__activeElement&&0===a.__activeColumn.columnName.indexOf("params::")){var e="params::"+(a.__nameTextbox.getText()||"");a.__activeColumn.columnName=e,a.__activeColumn.label||(a.__activeElement.firstChild.nodeValue=e)}},a.__onLabelChanged=function(){if(a.__activeColumn&&a.__activeElement&&0===a.__activeColumn.columnName.indexOf("params::")){var e=a.__labelTextbox.getText();e?a.__activeColumn.label=e:delete a.__activeColumn.label,a.__activeColumn.label?a.__activeElement.firstChild.nodeValue=a.__activeColumn.label:a.__activeColumn.columnName?a.__activeElement.firstChild.nodeValue=a.__activeColumn.columnName:a.__activeElement.firstChild.nodeValue="params::"}},a.__elementAvailableColumns=a.__elementContent.getElementsByClassName("tchmi-event-grid-template-columns-config-available-columns")[0],a.__elementSelectedColumns=a.__elementContent.getElementsByClassName("tchmi-event-grid-template-columns-config-selected-columns")[0];var n=a.__elementContent.getElementsByClassName("tchmi-event-grid-template-columns-config-order-buttons")[0],i=a.__elementContent.getElementsByClassName("tchmi-event-grid-template-column-width")[0];if(a.__elementColumnName=a.__elementContent.getElementsByClassName("tchmi-event-grid-template-column-name")[0],a.__elementColumnLabel=a.__elementContent.getElementsByClassName("tchmi-event-grid-template-column-label")[0],!(a.__elementAvailableColumns&&a.__elementSelectedColumns&&n&&i&&a.__elementColumnName&&a.__elementColumnLabel))throw new Error("Invalid Template.html");for(var o in a.__columns)a.__columns.hasOwnProperty(o)&&a.__availableColumns.push({name:o,element:a.__createColumnDiv(a.__columns[o].label)});a.__availableColumns.sort(function(e,t){return a.__columns[e.name].order-a.__columns[t.name].order});var r=u.ControlFactory.createEx("tchmi-button",a.__parentControl.getId()+"."+a.__name+".upButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Move the selected column up"},a.__parentControl),l=u.ControlFactory.createEx("tchmi-button",a.__parentControl.getId()+"."+a.__name+".downButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Move the selected column down"},a.__parentControl),s=u.ControlFactory.createEx("tchmi-textbox",a.__parentControl.getId()+"."+a.__name+".widthTextbox",{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-text-horizontal-alignment":"Right","data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},a.__parentControl),_=u.ControlFactory.createEx("tchmi-combobox",a.__parentControl.getId()+"."+a.__name+".widthUnitCombobox",{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-src-data":[{text:"px",value:"px"},{text:"%",value:"%"}],"data-tchmi-content-padding":{left:4,right:4},"data-tchmi-is-enabled":!1},a.__parentControl),d=u.ControlFactory.createEx("tchmi-textbox",a.__parentControl.getId()+"."+a.__name+".nameTextbox",{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:44,right:3},"data-tchmi-is-enabled":!1},a.__parentControl),h=u.ControlFactory.createEx("tchmi-textbox",a.__parentControl.getId()+"."+a.__name+".labelTextbox",{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},a.__parentControl);if(!(r&&l&&s&&_&&d&&h))throw new Error("Could not create controls for ColumnsPopup.");a.__upButton=r,a.__downButton=l,a.__widthTextbox=s,a.__widthUnitCombobox=_,a.__nameTextbox=d,a.__labelTextbox=h;var c=r.getElement()[0];c.classList.add("tchmi-event-grid-template-move-up-button"),n.appendChild(c),a.__eventDestroyers.push(u.EventProvider.register(r.getId()+".onPressed",a.__onUpPressed));var m=l.getElement()[0];return m.classList.add("tchmi-event-grid-template-move-down-button"),n.appendChild(m),a.__eventDestroyers.push(u.EventProvider.register(l.getId()+".onPressed",a.__onDownPressed)),i.appendChild(s.getElement()[0]),a.__eventDestroyers.push(u.EventProvider.register(s.getId()+".onTextChanged",a.__onWidthChanged)),i.appendChild(_.getElement()[0]),a.__eventDestroyers.push(u.EventProvider.register(_.getId()+".onSelectionChanged",a.__onWidthUnitChanged)),a.__elementColumnName.appendChild(d.getElement()[0]),a.__eventDestroyers.push(u.EventProvider.register(d.getId()+".onTextChanged",a.__onNameChanged)),a.__elementColumnLabel.appendChild(h.getElement()[0]),a.__eventDestroyers.push(u.EventProvider.register(h.getId()+".onTextChanged",a.__onLabelChanged)),a.__elementAvailableColumns.addEventListener("click",a.__onAvailableColumnClick),a.__elementSelectedColumns.addEventListener("click",a.__onSelectedColumnClick),a}e=u.Controls||(u.Controls={}),t=e.Beckhoff||(e.Beckhoff={}),n=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}),p=n.SettingsPopup,__extends(o,p),o.prototype.destroy=function(){p.prototype.destroy.call(this),this.__elementAvailableColumns.removeEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.removeEventListener("click",this.__onSelectedColumnClick)},o.prototype.update=function(i){var o=this;function e(t,e){0!==a.__availableColumns[t].name.indexOf("params::")&&-1!==a.__findIndex(i,function(e){return e.columnName===o.__availableColumns[t].name})&&(a.__selectedColumns.push(a.__availableColumns[t]),a.__availableColumns.splice(t,1),t--,e--),n=t,r=e}p.prototype.update.call(this,i);for(var n,r,a=this,t=0,l=this.__availableColumns.length;t<l;t++)e(t,l),t=n,l=r;function s(t,e){0===h.__selectedColumns[t].name.indexOf("params::")?(h.__selectedColumns.splice(t,1),t--,e--):-1===h.__findIndex(i,function(e){return e.columnName===o.__selectedColumns[t].name})&&(h.__availableColumns.push(h.__selectedColumns[t]),h.__selectedColumns.splice(t,1),t--,e--),_=t,d=e}var _,d,h=this;for(t=0,l=this.__selectedColumns.length;t<l;t++)s(t,l),t=_,l=d;i.filter(function(e){return 0===e.columnName.indexOf("params::")}).forEach(function(e){return o.__selectedColumns.push({name:e.columnName,element:o.__createColumnDiv(e.label||e.columnName||"params::")})}),this.__availableColumns.sort(function(e,t){return o.__columns[e.name].order-o.__columns[t.name].order}),this.__selectedColumns.sort(function(t,n){return o.__findIndex(i,function(e){return e.columnName===t.name})-o.__findIndex(i,function(e){return e.columnName===n.name})});var c=document.createDocumentFragment();for(t=0,l=this.__availableColumns.length;t<l;t++)c.appendChild(this.__availableColumns[t].element);this.__elementAvailableColumns.textContent="",this.__elementAvailableColumns.appendChild(c);var m=document.createDocumentFragment();for(t=0,l=this.__selectedColumns.length;t<l;t++)m.appendChild(this.__selectedColumns[t].element);this.__elementSelectedColumns.textContent="",this.__elementSelectedColumns.appendChild(m),this.__activateColumn(null)},o.prototype.__findIndex=function(e,t){for(var n=0,i=e.length;n<i;n++)if(t(e[n]))return n;return-1},o.prototype.__activateColumn=function(t){if(this.__activeElement&&this.__activeElement.classList.remove("active"),t){(this.__activeElement=t).classList.add("active");var e=this.__selectedColumns.findIndex(function(e){return e.element===t});this.__activeColumn=this.__settings[e]||null}else this.__activeElement=null,this.__activeColumn=null;this.__updateButtons(),this.__updateColumnProperties()},o.prototype.__updateButtons=function(){this.__upButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.firstElementChild),this.__downButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.lastElementChild)},o.prototype.__updateColumnProperties=function(){function e(){t.__nameTextbox.setIsEnabled(!1),t.__labelTextbox.setIsEnabled(!1),t.__elementColumnName.classList.add("hidden"),t.__elementColumnLabel.classList.add("hidden")}var t=this;if(this.__activeColumn){if(this.__widthTextbox.setIsEnabled(!0),this.__widthUnitCombobox.setIsEnabled(!0),void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width?this.__widthTextbox.setText(this.__activeColumn.width.toString(10)):this.__widthTextbox.setText(null),this.__activeColumn.widthUnit){var n=-1,i=this.__widthUnitCombobox.getSrcData();Array.isArray(i)&&(n=this.__findIndex(i,function(e){return e.value===t.__activeColumn.widthUnit})),this.__widthUnitCombobox.setSelectedIndex(-1!==n?n:null)}else this.__widthUnitCombobox.setSelectedIndex(null);0===this.__activeColumn.columnName.indexOf("params::")?(this.__nameTextbox.setIsEnabled(!0),this.__labelTextbox.setIsEnabled(!0),this.__nameTextbox.setText(this.__activeColumn.columnName.slice("params::".length)),this.__labelTextbox.setText(this.__activeColumn.label||null),this.__elementColumnName.classList.remove("hidden"),this.__elementColumnLabel.classList.remove("hidden")):e()}else this.__widthTextbox.setIsEnabled(!1),this.__widthUnitCombobox.setIsEnabled(!1),this.__widthTextbox.setText(null),this.__widthUnitCombobox.setSelectedIndex(null),e()},o.prototype.__createColumnDiv=function(e){var t=document.createElement("div");t.classList.add("tchmi-event-grid-template-columns-config-column"),t.textContent=e;var n=document.createElement("div");return n.classList.add("tchmi-event-grid-template-columns-config-column-selection-toggle"),t.appendChild(n),t},i=o,n.ColumnsPopup=i}(TcHmi=TcHmi||{}),function(T){var e,m,t,v,n;function i(e,t){var n=v.call(this,e,"filterPopup",t)||this;n.__settings=[],n.__localizableEnums=[],n.__rows=[],n.__selectedRows=[],n.__groupInfo=null,n.__ungroupInfo=null,n.__onScroll=function(e){n.__elementFilterTableHeader.scrollLeft=n.__elementFilterTable.scrollLeft},n.__onLocaleChangedDestroyer=null,n.__onLocaleChanged=function(){n.__localizeEnumLabels()},n.__requestId=null;var i=n.__elementContent.getElementsByClassName("tchmi-event-grid-template-filter-table-header")[0];i&&(n.__elementFilterTableHeader=i);var o=n.__elementContent.querySelector("th.tchmi-event-grid-template-filter-indentation-column");o&&(n.__elementIndentationHeader=o);var r=n.__elementContent.getElementsByClassName("tchmi-event-grid-template-filter-table")[0];r&&(n.__elementFilterTable=r);var a=n.__elementContent.querySelector(".tchmi-event-grid-template-filter-table tbody");a&&(n.__elementFilterTableBody=a);var l=n.__elementContent.getElementsByClassName("tchmi-event-grid-template-filter-menubar")[0];if(!(i&&o&&r&&a&&l))throw new Error("Invalid Template.html");r.addEventListener("scroll",n.__onScroll);var s=T.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".addButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Add a filter clause"},n.__parentControl),_=T.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".removeButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Remove selected filter clauses"},n.__parentControl),d=T.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".groupButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Group selected filter clauses"},n.__parentControl),h=T.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".ungroupButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Ungroup selected filter clauses"},n.__parentControl);if(!(s&&_&&d&&h))throw new Error("Could not create controls for FilterPopup.");_.setIsEnabled(!1),d.setIsEnabled(!1),h.setIsEnabled(!1);var c=s.getElement()[0];c.classList.add("tchmi-event-grid-template-add-button"),l.appendChild(c);var m=_.getElement()[0];m.classList.add("tchmi-event-grid-template-remove-button"),l.appendChild(m);var u=d.getElement()[0];u.classList.add("tchmi-event-grid-template-group-button"),l.appendChild(u);var p=h.getElement()[0];p.classList.add("tchmi-event-grid-template-ungroup-button"),l.appendChild(p),n.__eventDestroyers.push(T.EventProvider.register(s.getId()+".onPressed",function(){n.__add()})),n.__eventDestroyers.push(T.EventProvider.register(_.getId()+".onPressed",function(){n.__remove()})),n.__eventDestroyers.push(T.EventProvider.register(d.getId()+".onPressed",function(){n.__group()})),n.__eventDestroyers.push(T.EventProvider.register(h.getId()+".onPressed",function(){n.__ungroupInfo&&n.__ungroup(n.__ungroupInfo,n.__selectedRows)})),n.__removeButton=_,n.__groupButton=d,n.__ungroupButton=h;var g=n.__parseSchema(T.Type.getSchema("tchmi:server#/definitions/eventFilter"));return n.__schemaInfo=g.schemaInfo,n.__localizableEnums=g.localizationInfo,n.__localizeEnumLabels(),n.__onLocaleChangedDestroyer=T.EventProvider.register("onLocaleChanged",n.__onLocaleChanged),n}e=T.Controls||(T.Controls={}),m=e.Beckhoff||(e.Beckhoff={}),t=m.TcHmiEventGridPopups||(m.TcHmiEventGridPopups={}),v=t.SettingsPopup,__extends(i,v),i.prototype.update=function(e){var s=this;v.prototype.update.call(this,e),this.__selectedRows=[];var _=document.createDocumentFragment(),d=[],h=0,c={filter:this.__settings,parent:null},m=function(e,t,n){void 0===n&&(n=0);for(var i=0,o=e.length;i<o;i++){var r=e[i];if(T.isLogicOperator(r))t=r;else if(Array.isArray(r))d.push("first"),h=Math.max(h,d.length),c={filter:r,parent:c},i===o-1?m(r,t,n+1):m(r,t),c.parent&&(c=c.parent);else if(T.isComparison(r)){if(i===o-1)for(var a=0;a<=n;a++)d[d.length-(a+1)]="last";if(_.appendChild(s.__createRow(d,c,r,t)),i===o-1)d=d.slice(0,-(n+1));else{a=0;for(var l=d.length;a<l;a++)d[a]="middle"}}}};m(this.__settings),this.__elementFilterTableBody.innerHTML="",this.__elementFilterTableBody.appendChild(_),this.__elementIndentationHeader.style.minWidth=h?6*h+5+"px":"1px",this.__processSelection()},i.prototype.hide=function(){v.prototype.hide.call(this),this.__updateRequired&&this.__clear()},i.prototype.destroy=function(){v.prototype.destroy.call(this),this.__elementFilterTable.removeEventListener("scroll",this.__onScroll),this.__onLocaleChangedDestroyer&&(this.__onLocaleChangedDestroyer(),this.__onLocaleChangedDestroyer=null),null!==this.__requestId&&(T.Server.releaseRequest(this.__requestId),this.__requestId=null),this.__clear()},i.prototype.__clear=function(){this.__elementFilterTableBody.innerHTML="";for(var e=0,t=this.__rows.length;e<t;e++){var n=this.__rows[e];n.selection.destroyer(),n.logic&&n.logic.destroyer(),n.path.destroyer&&n.path.destroyer(),n.comparator.destroyer&&n.comparator.destroyer(),n.value.destroyer&&n.value.destroyer(),n.value.dateTimePickerEventDestroyer&&n.value.dateTimePickerEventDestroyer(),n.value.dateTimeButtonEventDestroyer&&n.value.dateTimeButtonEventDestroyer()}this.__rows=[]},i.prototype.__createRow=function(e,t,i,n){var o=this,r=document.createElement("tr"),a=document.createElement("td");a.classList.add("tchmi-event-grid-template-filter-selection-column");var l=T.ControlFactory.createEx("tchmi-checkbox",this.__newControlId(),null,this.__parentControl);if(!l)throw new Error("Could not create controls for FilterPopup.");var s=this.__cloneNesting(t),_=T.EventProvider.register(l.getId()+".onStateChanged",function(e,t){var n={rowElement:r,comparison:i,parent:s};t.state?o.__selectRow(n):o.__deselectRow(n)});a.appendChild(l.getElement()[0]);var d=document.createElement("td");d.classList.add("tchmi-event-grid-template-filter-indentation-column");for(var h=0,c=e.length;h<c;h++){var m=document.createElement("div");m.classList.add("tchmi-event-grid-template-filter-indentation-marker"),m.classList.add(e[h]),d.appendChild(m)}var u=document.createElement("td");u.classList.add("tchmi-event-grid-template-filter-logic-column");var p=document.createElement("td");p.classList.add("tchmi-event-grid-template-filter-path-column");var g=document.createElement("td");g.classList.add("tchmi-event-grid-template-filter-comparator-column");var v=document.createElement("td");v.classList.add("tchmi-event-grid-template-filter-value-column");var f={row:r,comparison:i,parent:s,selection:{destroyer:_},path:{destroyer:null},comparator:{cell:g,control:null,destroyer:null},value:{cell:v,control:null,destroyer:null,dateTimePicker:null,dateTimePickerEventDestroyer:null,dateTimeButton:null,dateTimeButtonEventDestroyer:null}};if(n){f.logicOperator=n;var C=T.ControlFactory.createEx("tchmi-combobox",this.__newControlId(),{"data-tchmi-src-data":this.__schemaInfo.availableLogic,"data-tchmi-selected-index":this.__schemaInfo.availableLogic.indexOf(n.logic),"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!C)throw new Error("Could not create controls for FilterPopup.");f.logic={destroyer:T.EventProvider.register(C.getId()+".onSelectionChanged",function(e,t){n.logic=t.value})},u.appendChild(C.getElement()[0])}var y=Object.keys(this.__schemaInfo.availablePaths);if(0<y.length){var b=T.ControlFactory.createEx("tchmi-combobox",this.__newControlId(),{"data-tchmi-src-data":y,"data-tchmi-allow-text-input":null!==this.__schemaInfo.freePath,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl);if(!b)throw new Error("Could not create controls for FilterPopup.");var E=y.indexOf(i.path||"");-1!==y.indexOf(i.path||"")?b.setSelectedIndex(E):b.setText(i.path),f.path.destroyer=T.EventProvider.register(b.getId()+".onUserInteractionFinished",function(){var e=b.getText();i.path!==e&&(null==e||""===e?delete i.path:i.path=e.toString(),i.value="",o.__updateControls(f))}),p.appendChild(b.getElement()[0])}else{var S=T.ControlFactory.createEx("tchmi-textbox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!S)throw new Error("Could not create controls for FilterPopup.");f.path.destroyer=T.EventProvider.register(S.getId()+".onUserInteractionFinished",function(){var e=S.getText();null==e||""===e?delete i.path:i.path=e}),p.appendChild(S.getElement()[0])}return this.__updateControls(f),r.appendChild(a),r.appendChild(d),r.appendChild(u),r.appendChild(p),r.appendChild(g),r.appendChild(v),this.__rows.push(f),r},i.prototype.__updateControls=function(t){var n=this.__schemaInfo.availablePaths[t.comparison.path||""];if(!n&&this.__schemaInfo.freePath&&(n=this.__schemaInfo.freePath),!t.comparator.control){if(t.comparator.control=T.ControlFactory.createEx("tchmi-combobox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl)||null,!t.comparator.control)throw new Error("Could not create controls for FilterPopup.");t.comparator.destroyer=T.EventProvider.register(t.comparator.control.getId()+".onUserInteractionFinished",function(){var e=t.comparator.control.getText();"string"==typeof e&&""!==e&&(t.comparison.comparator=e)}),t.comparator.cell.appendChild(t.comparator.control.getElement()[0])}var e=t.comparator.control;n?(e.setAllowTextInput(!1),e.setSrcData(n.comparators),e.setSelectedIndex(n.comparators.indexOf(t.comparison.comparator))):e.setAllowTextInput(!0);var i="tchmi-textbox";n&&0<n.values.length&&(i="tchmi-combobox"),t.value.control&&t.value.control.getType()!==i&&(t.value.destroyer&&(t.value.destroyer(),t.value.destroyer=null),t.value.cell.removeChild(t.value.control.getElement()[0]),t.value.control.destroy(),t.value.control=null);var o=!1;if(!t.value.control){if(t.value.control=T.ControlFactory.createEx(i,this.__newControlId(),"tchmi-combobox"===i?{"data-tchmi-max-list-height":250}:{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl)||null,!t.value.control)throw new Error("Could not create controls for FilterPopup.");o=!0,t.value.cell.appendChild(t.value.control.getElement()[0])}switch(i){case"tchmi-textbox":var r=t.value.control,a=void 0;a=t.comparison.value instanceof Date?t.comparison.value.toISOString():t.comparison.value.toString(),r.setText(a),o&&(t.value.destroyer=T.EventProvider.register(r.getId()+".onUserInteractionFinished",function(){var e=r.getText();if(null!=e){switch(n?n.valueType:"any"){case"string":t.comparison.value=T.ValueConverter.toString(e,"");break;case"number":case"integer":t.comparison.value=T.ValueConverter.toNumber(e,0);break;case"boolean":t.comparison.value=T.ValueConverter.toBoolean(e,!1);break;default:t.comparison.value=e}t.value.dateTimePicker&&t.value.dateTimePicker.setValue(e)}}));break;case"tchmi-combobox":var l=t.value.control;if(!n)break;for(var s,_=[],d=0,h=n.values.length;d<h;d++){var c=n.values[d];_.push({value:c,text:n.localizedLabels[c]||c})}l.setSrcData(_),l.setAllowTextInput(n.allowFreeValue),l.setSelectedIndex(n.values.indexOf(t.comparison.value)),n.allowFreeValue&&-1===n.values.indexOf(t.comparison.value)&&(s=t.comparison.value instanceof Date?t.comparison.value.toISOString():t.comparison.value.toString(),l.setText(s)),o&&(t.value.destroyer=T.EventProvider.register(l.getId()+".onUserInteractionFinished",function(){var e=l.getSelectedValue();if(null==e&&n.allowFreeValue&&(e=l.getText),null!=e)switch(n?n.valueType:"any"){case"string":t.comparison.value=T.ValueConverter.toString(e,"");break;case"number":case"integer":t.comparison.value=T.ValueConverter.toNumber(e,0);break;case"boolean":t.comparison.value=T.ValueConverter.toBoolean(e,!1);break;default:t.comparison.value=e}}))}if(n&&n.valueIsDate){if(!t.value.dateTimePicker){if(t.value.dateTimePicker=T.ControlFactory.createEx("tchmi-date-time-picker",this.__newControlId(),{"data-tchmi-visibility":"Collapsed"},this.__parentControl)||null,!t.value.dateTimePicker)throw new Error("Could not create controls for FilterPopup.");t.value.dateTimePickerEventDestroyer=T.EventProvider.register(t.value.dateTimePicker.getId()+".onValueChanged",function(){var e=t.value.dateTimePicker.getValue();e&&(t.value.control&&t.value.control.setText(e),t.comparison.value=e)}),t.value.cell.appendChild(t.value.dateTimePicker.getElement()[0])}if(t.value.dateTimePicker.setValue("string"==typeof t.comparison.value?t.comparison.value:null),!t.value.dateTimeButton){if(t.value.dateTimeButton=T.ControlFactory.createEx("tchmi-button",this.__newControlId(),{"data-tchmi-width":26,"data-tchmi-height":30},this.__parentControl)||null,!t.value.dateTimeButton)throw new Error("Could not create controls for FilterPopup.");t.value.dateTimeButtonEventDestroyer=T.EventProvider.register(t.value.dateTimeButton.getId()+".onPressed",function(){t.value.dateTimePicker&&t.value.dateTimePicker.openDateTimePicker()});var m=t.value.dateTimeButton.getElement()[0];m.classList.add("tchmi-event-grid-template-date-time-button"),t.value.cell.appendChild(m)}}else t.value.dateTimePickerEventDestroyer&&(t.value.dateTimePickerEventDestroyer(),t.value.dateTimePickerEventDestroyer=null),t.value.dateTimePicker&&(t.value.cell.removeChild(t.value.dateTimePicker.getElement()[0]),t.value.dateTimePicker.destroy(),t.value.dateTimePicker=null),t.value.dateTimeButtonEventDestroyer&&(t.value.dateTimeButtonEventDestroyer(),t.value.dateTimeButtonEventDestroyer=null),t.value.dateTimeButton&&(t.value.cell.removeChild(t.value.dateTimeButton.getElement()[0]),t.value.dateTimeButton.destroy(),t.value.dateTimeButton=null)},i.prototype.__selectRow=function(e){this.__selectedRows.push(e),this.__processSelection()},i.prototype.__deselectRow=function(e){for(var t=0,n=this.__selectedRows.length;t<n;t++)if(this.__selectedRows[t].comparison===e.comparison){this.__selectedRows.splice(t,1);break}this.__processSelection()},i.prototype.__add=function(){var e=this.__schemaInfo.freePath?"":Object.keys(this.__schemaInfo.availablePaths)[0],t=this.__schemaInfo.freePath?this.__schemaInfo.freePath:this.__schemaInfo.availablePaths[e],n={logic:this.__schemaInfo.availableLogic[0]},i={path:e,comparator:t.comparators[0],value:t.allowFreeValue?"":t.values[0]};if(0<this.__selectedRows.length){this.__selectedRows.sort(function(e,t){return t.rowElement.rowIndex-e.rowElement.rowIndex});var o=this.__selectedRows[0];o.parent.filter.splice(o.parent.filter.indexOf(o.comparison)+1,0,n,i);for(var r=[],a=o.rowElement.getElementsByClassName("tchmi-event-grid-template-filter-indentation-marker"),l=0,s=a.length;l<s;l++)"last"===a[l].classList[1]?(a[l].classList.remove("last"),a[l].classList.add("middle"),r.push("last")):r.push("middle");o.rowElement.insertAdjacentElement("afterend",this.__createRow(r,o.parent,i,n))}else this.__elementFilterTableBody.appendChild(this.__createRow([],{filter:this.__settings,parent:null},i,0<this.__settings.length?n:void 0)),0<this.__settings.length&&this.__settings.push(n),this.__settings.push(i);this.__processSelection()},i.prototype.__remove=function(){for(var e=0,t=this.__selectedRows.length;e<t;e++){var n=this.__selectedRows[e],i=n.parent.filter.indexOf(n.comparison);if(-1!==i){for(var o=n.rowElement.getElementsByClassName("tchmi-event-grid-template-filter-indentation-marker"),r=null,a=0,l=o.length;a<l;a++)if("first"===o[a].classList[1]){if(!r){if(!(s=n.rowElement.nextElementSibling))break;r=s.getElementsByClassName("tchmi-event-grid-template-filter-indentation-marker")}r[a].classList.remove("middle"),r[a].classList.add("first")}else if("last"===o[a].classList[1]){if(!r){var s;if(!(s=n.rowElement.previousElementSibling))break;r=s.getElementsByClassName("tchmi-event-grid-template-filter-indentation-marker")}r[a].classList.remove("middle"),r[a].classList.add("last")}for(var _=-1,d=0,h=this.__rows.length;d<h;d++)if(this.__rows[d].row===n.rowElement){_=d;break}if(-1!==_){var c=this.__rows[_];c.selection.destroyer(),c.logic&&c.logic.destroyer(),c.path.destroyer&&c.path.destroyer(),c.comparator.destroyer&&c.comparator.destroyer(),c.value.destroyer&&c.value.destroyer(),c.value.dateTimePickerEventDestroyer&&c.value.dateTimePickerEventDestroyer(),c.value.dateTimeButtonEventDestroyer&&c.value.dateTimeButtonEventDestroyer(),this.__rows.splice(_,1)}if(this.__elementFilterTableBody.removeChild(n.rowElement),n.parent.filter.splice(i,1),0<i)n.parent.filter.splice(i-1,1);else{for(var m=n.parent,u=0;m.parent;){if(-1===(u=m.parent.filter.indexOf(m.filter)))throw new Error("Filter in invalid state. Parent filter does not contain child filter.");if(0!==u)break;m=m.parent}if(0===u){0<n.parent.filter.length&&n.parent.filter.splice(0,1);var p=this.__elementFilterTableBody.firstElementChild;if(p){for(d=0,h=this.__rows.length;d<h;d++)if(this.__rows[d].row===n.rowElement){this.__rows[d].logic&&(this.__rows[d].logic.destroyer(),delete this.__rows[d].logic);break}var g=p.querySelector(".tchmi-event-grid-template-filter-logic-column .tchmi-combobox");g&&g.parentElement.removeChild(g)}}else m.filter.splice(u-1,1,n.parent.filter.splice(0,1)[0])}if(1===n.parent.filter.length&&n.parent.parent){var v=[];for(d=0,h=this.__rows.length;d<h;d++){for(var f=this.__rows[d].parent;f&&f.filter!==n.parent.filter;)f=f.parent;f&&v.push({rowElement:this.__rows[d].row,comparison:this.__rows[d].comparison,parent:this.__rows[d].parent})}0<v.length&&this.__ungroup({parent:n.parent.parent,toUngroup:n.parent},v)}}}this.__selectedRows=[],this.__processSelection()},i.prototype.__group=function(){if(this.__groupInfo){for(var e=this.__groupInfo.parent.filter.length,t=-1,n=0,i=this.__groupInfo.toGroup.length;n<i;n++){var o=this.__groupInfo.parent.filter.indexOf(this.__groupInfo.toGroup[n]);if(-1===o)return;e=o<e?o:e,t=t<o?o:t}var r=this.__groupInfo.parent.filter.splice(e,t-e+1);this.__groupInfo.parent.filter.splice(e,0,r),this.__selectedRows.sort(function(e,t){return e.rowElement.rowIndex-t.rowElement.rowIndex});var a={filter:this.__groupInfo.parent.filter,parent:this.__groupInfo.parent.parent},l=this.__groupInfo.parent.filter;for(n=0,i=this.__selectedRows.length;n<i;n++){for(var s=this.__selectedRows[n].parent,_=0;s.parent&&s.filter!==l;)s=s.parent,_++;s.filter=r,s.parent=this.__cloneNesting(a);var d=this.__selectedRows[n].rowElement.getElementsByClassName("tchmi-event-grid-template-filter-indentation-column")[0];if(d){var h=document.createElement("div");h.classList.add("tchmi-event-grid-template-filter-indentation-marker"),0===n?h.classList.add("first"):n+1===i?h.classList.add("last"):h.classList.add("middle"),d.insertBefore(h,d.childNodes[d.childElementCount-_]||null)}}this.__processSelection(),this.__resizeIndentationHeader()}},i.prototype.__ungroup=function(e,t){var n,i=e.parent.filter.indexOf(e.toUngroup.filter);if(-1!==i){(n=e.parent.filter).splice.apply(n,[i,1].concat(e.toUngroup.filter)),t.sort(function(e,t){return e.rowElement.rowIndex-t.rowElement.rowIndex});for(var o=0,r=t.length;o<r;o++){for(var a=t[o].parent;a.parent&&a.parent.filter!==e.parent.filter;)a=a.parent;a.filter=e.parent.filter,a.parent=e.parent.parent?this.__cloneNesting(e.parent.parent):null;var l=void 0;(l=0===o?t[o].rowElement.querySelector(".tchmi-event-grid-template-filter-indentation-marker.first"):o+1===r?t[o].rowElement.querySelector(".tchmi-event-grid-template-filter-indentation-marker.last"):t[o].rowElement.querySelector(".tchmi-event-grid-template-filter-indentation-marker.middle"))&&l.parentElement.removeChild(l)}this.__processSelection(),this.__resizeIndentationHeader()}},i.prototype.__processSelection=function(){if(this.__removeButton.setIsEnabled(0<this.__selectedRows.length),this.__groupInfo=null,this.__ungroupInfo=null,this.__selectedRows.length<2)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);function e(e,t){var n=l.__selectedRows[e];a[n.rowElement.rowIndex]=!0;var i=r.firstOrDefault(function(e){return e.nesting.filter===n.parent.filter});for(i||(i={nesting:n.parent,itemCount:Math.ceil(n.parent.filter.length/2),selectedItems:[]},r.push(i)),i.selectedItems.push(n.comparison);i.selectedItems.length>=i.itemCount&&(e+1<t||1<r.length);){if(!i.nesting.parent)return l.__groupButton.setIsEnabled(!1),l.__ungroupButton.setIsEnabled(!1),{value:void 0};var o=r.firstOrDefault(function(e){return e.nesting.filter===i.nesting.parent.filter});o||(o={nesting:i.nesting.parent,itemCount:Math.ceil(i.nesting.parent.filter.length/2),selectedItems:[]},r.push(o)),o.selectedItems.push(i.nesting.filter),r.splice(r.indexOf(i),1),i=o}}for(var r=new T.List,a=[],l=this,t=0,n=this.__selectedRows.length;t<n;t++){var i=e(t,n);if("object"==typeof i)return i.value}if(1===r.length){var o=r[0],s=!0;for(t=a.indexOf(!0),n=a.length;t<n;t++)if(!a[t]){s=!1;break}o.selectedItems.length<o.itemCount&&s?this.__groupInfo={parent:o.nesting,toGroup:o.selectedItems}:o.selectedItems.length===o.itemCount&&o.nesting.parent&&(this.__ungroupInfo={parent:o.nesting.parent,toUngroup:o.nesting})}this.__groupButton.setIsEnabled(null!==this.__groupInfo),this.__ungroupButton.setIsEnabled(null!==this.__ungroupInfo)},i.prototype.__resizeIndentationHeader=function(){var e=this.__elementFilterTableBody.getElementsByClassName("tchmi-event-grid-template-filter-indentation-column")[0];this.__elementIndentationHeader.style.minWidth=(e?e.offsetWidth:0)+"px"},i.prototype.__newControlId=function(){return this.__parentControl.getId()+"."+this.__name+"."+tchmi_create_guid()},i.prototype.__cloneNesting=function(e){return{filter:e.filter,parent:e.parent?this.__cloneNesting(e.parent):null}},i.prototype.__parseSchema=function(e){if(e&&"array"===e.type&&e.items){var t=null;if(Array.isArray(e.items)?t=e.items:"object"===e.items.type?t=[e.items]:e.items.anyOf?t=e.items.anyOf:e.items.oneOf&&(t=e.items.oneOf),t){for(var n={availablePaths:{},freePath:null,availableLogic:[]},i=[],o=0,r=t.length;o<r;o++){var a=t[o];if("object"===a.type&&a.properties&&a.properties.logic&&a.properties.logic.enum)for(var l=0,s=a.properties.logic.enum.length;l<s;l++)-1===n.availableLogic.indexOf(a.properties.logic.enum[l])&&n.availableLogic.push(a.properties.logic.enum[l]);else if("object"===a.type&&a.properties&&a.properties.comparator&&a.properties.comparator.enum&&a.properties.value){var _=null;a.properties.path?a.properties.path.enum&&(_=a.properties.path.enum):_=[""];var d=[];if(_)for(l=0,s=_.length;l<s;l++)n.availablePaths[_[l]]||(n.availablePaths[_[l]]={comparators:[],values:[],labels:{},localizedLabels:{},allowFreeValue:!1,valueIsDate:!1,valueType:"any"}),d.push(n.availablePaths[_[l]]);else n.freePath||(n.freePath={comparators:[],values:[],labels:{},localizedLabels:{},allowFreeValue:!1,valueIsDate:!1,valueType:"any"}),d.push(n.freePath);for(l=0,s=d.length;l<s;l++){for(var h=0,c=a.properties.comparator.enum.length;h<c;h++)-1===d[l].comparators.indexOf(a.properties.comparator.enum[h])&&d[l].comparators.push(a.properties.comparator.enum[h]);if("string"!==a.properties.value.type&&"number"!==a.properties.value.type&&"integer"!==a.properties.value.type&&"boolean"!==a.properties.value.type||(d[l].valueType=a.properties.value.type),a.properties.value.enum)for(h=0,c=a.properties.value.enum.length;h<c;h++)-1===d[l].values.indexOf(a.properties.value.enum[h])&&d[l].values.push(a.properties.value.enum[h]);else d[l].allowFreeValue=!0;if(a.properties.value.options){for(h=0,c=a.properties.value.options.length;h<c;h++)d[l].labels[a.properties.value.options[h].value]=a.properties.value.options[h].label,d[l].localizedLabels[a.properties.value.options[h].value]=a.properties.value.options[h].label;i.push(d[l])}"date-time"===a.properties.value.format&&(d[l].valueIsDate=!0)}}}return{schemaInfo:n,localizationInfo:i}}}return{schemaInfo:{availablePaths:{},freePath:{comparators:["==","!=","<",">","<=",">=","contains","contains not","== [ignore case]","!= [ignore case]","contains [ignore case]","contains not [ignore case]"],values:[],labels:{},localizedLabels:{},allowFreeValue:!0,valueIsDate:!1,valueType:"any"},availableLogic:["AND","OR"]},localizationInfo:[]}},i.prototype.__localizeEnumLabels=function(){var h=this;if(0!==this.__localizableEnums.length){for(var e={requestType:"ReadWrite",commands:[]},c={},t=0,n=this.__localizableEnums.length;t<n;t++)for(var i in this.__localizableEnums[t].labels){var o=this.__localizableEnums[t].labels[i];c[o]={pathInfo:this.__localizableEnums[t],key:i},e.commands.push({symbol:"LocalizeText",writeValue:{domain:"TcHmiSrv",name:o},commandOptions:["SendWriteValue","SendErrorMessage"]})}this.__requestId=T.Server.requestEx(e,null,function(e){if(h.__requestId=null,e.error===T.Errors.NONE)if(e.response){if(e.response.error)T.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+h.__parentControl.getId()+"] Server responds with error. Details: "+T.Log.buildMessage(e.response.error));else if(e.response.commands){for(var t=0,n=e.response.commands.length;t<n;t++)if(e.response.commands[t].error)T.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+h.__parentControl.getId()+"] Server responds with error for command for symbol="+e.response.commands[t].symbol+". Details: "+T.Log.buildMessage(e.response.commands[t].error));else{var i=e.response.commands[t].writeValue;"object"==typeof i&&i.name&&c[i.name]&&(c[i.name].pathInfo.localizedLabels[c[i.name].key]=e.response.commands[t].readValue)}for(t=0,n=h.__rows.length;t<n;t++)if(h.__rows[t].value.control instanceof m.TcHmiCombobox){var o=h.__schemaInfo.availablePaths[h.__rows[t].comparison.path||""];if(!o&&h.__schemaInfo.freePath&&(o=h.__schemaInfo.freePath),!o)return;for(var r=h.__rows[t].value.control,a=[],l=0,s=o.values.length;l<s;l++){var _=o.values[l];a.push({value:_,text:o.localizedLabels[_]||_})}var d=r.getSelectedIndex();r.setSrcData(a),r.setSelectedIndex(void 0===d?null:d)}}}else T.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+h.__parentControl.getId()+"] Server responds incomplete: response missing. ");else T.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+h.__parentControl.getId()+"] Unable to localize text: "+T.Log.buildMessage(e.details))})}},n=i,t.FilterPopup=n}(TcHmi=TcHmi||{}),function(_){var e,t,n,a,i;function o(e,t){var n=a.call(this,e,"detailsPopup",t)||this;n.__event=null;var i=_.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".confirmButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Confirm this alarm"},n.__parentControl),o=_.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".closeButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Close","data-tchmi-tooltip":"Close popup"},n.__parentControl);if(!i||!o)throw new Error("Could not create controls for DetailsPopup.");n.__confirmButton=i;var r=n.__confirmButton.getElement()[0];return r.classList.add("tchmi-event-grid-template-confirm-button"),n.__elementFooter.appendChild(r),n.__eventDestroyers.push(_.EventProvider.register(n.__confirmButton.getId()+".onPressed",function(){n.__event&&_.Server.Events.isAlarm(n.__event.originalEvent)&&_.Server.Events.confirmAlarm(n.__event.originalEvent,function(e){e.error!==_.Errors.NONE&&(_.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+n.__parentControl.getId()+"] Unable to confirm alarm with id "+n.__event.id+" in domain "+n.__event.domain+": "+_.Log.buildMessage(e.details)),"object"==typeof e.details&&null!==e.details&&e.details.code===_.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&n.__parentControl.__setCanConfirm(!1))})})),n.__elementFooter.appendChild(o.getElement()[0]),n.__eventDestroyers.push(_.EventProvider.register(o.getId()+".onPressed",function(){return n.hide()})),n.__setCanConfirm(n.__parentControl.__getCanConfirm()),n}e=_.Controls||(_.Controls={}),t=e.Beckhoff||(e.Beckhoff={}),n=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}),a=n.Popup,__extends(o,a),o.prototype.update=function(e){this.__event=e;var t=document.createDocumentFragment(),o=document.createElement("dl");function n(e,t){var n=document.createElement("dt");n.textContent=e,o.appendChild(n);var i=document.createElement("dd");i.textContent=t||"-",o.appendChild(i)}t.appendChild(o),n("Domain",e.domain),n("Source Domain",e.sourceDomain);var i="";switch(e.type){case _.Server.Events.Type.Message:i="Message";break;case _.Server.Events.Type.Alarm:i="Alarm"}n("Type",i);var r="";switch(e.severity){case _.Server.Events.Severity.Verbose:r="Verbose";break;case _.Server.Events.Severity.Info:r="Info";break;case _.Server.Events.Severity.Warning:r="Warning";break;case _.Server.Events.Severity.Error:r="Error";break;case _.Server.Events.Severity.Critical:r="Critical"}if(n("Severity",r),e.type===_.Server.Events.Type.Alarm){var a="";switch(e.alarmState){case _.Server.Events.AlarmState.Raised:a="Raised";break;case _.Server.Events.AlarmState.Confirmed:a="Confirmed";break;case _.Server.Events.AlarmState.Cleared:a="Cleared";break;case _.Server.Events.AlarmState.ClearedAndConfirmed:a="Cleared and Confirmed"}e.originalEvent.confirmationState!==_.Server.Events.ConfirmationState.NotRequired&&e.originalEvent.confirmationState!==_.Server.Events.ConfirmationState.NotSupported||(a+=", no confirmation needed"),n("Alarm State",a)}n("Raised",_.Localization.formatDate(e.timeRaised)),e.type===_.Server.Events.Type.Alarm?(void 0!==e.timeCleared&&null!==e.timeCleared&&0<e.timeCleared.valueOf()?n("Cleared",_.Localization.formatDate(e.timeCleared)):n("Cleared",""),void 0!==e.timeConfirmed&&null!==e.timeConfirmed&&0<e.timeConfirmed.valueOf()?n("Confirmed",_.Localization.formatDate(e.timeConfirmed)):n("Confirmed",""),this.__confirmButton.setIsEnabled(e.originalEvent.confirmationState===_.Server.Events.ConfirmationState.WaitForConfirmation)):this.__confirmButton.setIsEnabled(!1),n("Name",e.name),n("Text",e.text);var l=document.createElement("dt");o.appendChild(l),l.textContent="Parameters";var s=document.createElement("dd");o.appendChild(s),e.params&&0<Object.keys(e.params).length?s.appendChild(function e(t){var n=document.createElement("dl");for(var i in t)if(t.hasOwnProperty(i)){var o=document.createElement("dt");n.appendChild(o),o.textContent=i.slice(0,1).toUpperCase()+i.slice(1).replace(/([A-Z]+)/g," $1");var r=document.createElement("dd");n.appendChild(r);var a=t[i];if(null==a||""===a)r.textContent="-";else if("object"==typeof a)r.appendChild(e(a));else if("string"==typeof a){var l=null;try{l=JSON.parse(a)}catch(e){}l&&"object"==typeof l?r.appendChild(e(l)):r.textContent=a}else r.textContent=a}return n}(e.params)):s.textContent="-",this.__elementContent.textContent="",this.__elementContent.appendChild(t)},o.prototype.getEvent=function(){return this.__event},o.prototype.__setCanConfirm=function(e){this.__confirmButton.getElement().toggleClass("tchmi-control-operate-disallowed",!e),this.__confirmButton.setIsEnabled(e)},i=o,n.DetailsPopup=i}(TcHmi=TcHmi||{}),function(a){var e,t,n,l,i;function o(e,t){var n=l.call(this,e,"confirmAllPopup",t)||this;if(n.__alarms=[],n.__elementAlarmCount=n.__elementContent.getElementsByClassName("tchmi-event-grid-template-confirm-all-popup-alarm-count")[0],!n.__elementAlarmCount)throw new Error("Invalid Template.html");var i=a.ControlFactory.createEx("tchmi-datagrid",n.__parentControl.getId()+"."+n.__name+".datagrid",{"data-tchmi-src-column":[{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:0,height:26,width:26,source:a.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/verbose.svg"},{text:"Info",value:1,height:26,width:26,source:a.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/info.svg"},{text:"Warning",value:2,height:26,width:26,source:a.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/warning.svg"},{text:"Error",value:3,height:26,width:26,source:a.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/error.svg"},{text:"Critical",value:4,height:26,width:26,source:a.Environment.getBasePath()+"/Controls/Beckhoff/TcHmiEventGrid/Themes/Base/Images/critical.svg"}]},{name:"timeRaised",label:"Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center"},{name:"text",label:"Text",control:"TextBlock",width:300,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,horizontalAlignment:"Left",verticalAlignment:"Center"}]},n.__parentControl),o=a.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".confirmButton",{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":"Yes, confirm all alarms","data-tchmi-tooltip":"Confirm all displayed alarms and close the popup"},n.__parentControl),r=a.ControlFactory.createEx("tchmi-button",n.__parentControl.getId()+"."+n.__name+".closeButton",{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Cancel","data-tchmi-tooltip":"Close the popup without confirming any alarm"},n.__parentControl);if(!i||!o||!r)throw new Error("Could not create controls for ConfirmAllPopup.");return n.__datagrid=i,n.__elementContent.appendChild(n.__datagrid.getElement()[0]),n.__elementFooter.appendChild(o.getElement()[0]),n.__eventDestroyers.push(a.EventProvider.register(o.getId()+".onPressed",function(){for(var e=0,t=n.__alarms.length;e<t;e++)a.Server.Events.confirmAlarm(n.__alarms[e],function(e){e.error!==a.Errors.NONE&&a.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+n.__parentControl.getId()+"] Unable to confirm alarm: "+a.Log.buildMessage(e.details)),"object"==typeof e.details&&null!==e.details&&e.details.code===a.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&n.__parentControl.__setCanConfirm(!1)});n.hide()})),n.__elementFooter.appendChild(r.getElement()[0]),n.__eventDestroyers.push(a.EventProvider.register(r.getId()+".onPressed",function(){return n.hide()})),n}e=a.Controls||(a.Controls={}),t=e.Beckhoff||(e.Beckhoff={}),n=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}),l=n.Popup,__extends(o,l),o.prototype.update=function(e){this.__alarms=e,this.__datagrid.setSrcData(this.__alarms),1<this.__alarms.length?this.__elementAlarmCount.textContent="these "+this.__alarms.length+" alarms":this.__elementAlarmCount.textContent="this alarm",this.__elementContent.style.height=30*this.__alarms.length+70+"px"},o.prototype.getAlarms=function(){return this.__alarms},i=o,n.ConfirmAllPopup=i}(TcHmi=TcHmi||{});