var TcHmi;!function(u){var t,p,s,e;function r(t,e,r){var o=s.call(this,t,e,r)||this;o.__targetUserControlControlObject=null,o.__params={},o.__partialDefaultVirtualRights={},o.__onUserControlChangedEventDestroyEvent=null,o.__onUserControlConfigChangedEventDestroyEvent=null,o.__onUserControlCreatedEventDestroyEvent=null,o.__onUserControlRemovedEventDestroyEvent=null;var n=o.__attrs["data-tchmi-target-user-control"];if(!n)throw new Error("Required attribute=data-tchmi-target-user-control is missing.");if(o.__targetUserControlUrl=n.value,!o.__targetUserControlUrl)throw new Error("Required attribute=data-tchmi-target-user-control has invalid value.");if(o.__targetUserControlUrlClean=tchmi_path(o.__targetUserControlUrl),!o.__targetUserControlUrlClean)throw new Error("Required attribute=data-tchmi-target-user-control has invalid value.");return o.__targetUserControlConfigUrl=o.__targetUserControlUrl.replace(".usercontrol",".usercontrol.json"),o.__targetUserControlConfigUrlClean=tchmi_path(o.__targetUserControlConfigUrl),!0===TCHMI_ENABLE_DESIGNER_MODE&&(o.__onUserControlChangedEventDestroyEvent=u.EventProvider.register("System.onUserControlChanged",o.__onUserControlChanged()),o.__onUserControlConfigChangedEventDestroyEvent=u.EventProvider.register("System.onUserControlConfigChanged",o.__onUserControlConfigChanged()),o.__onUserControlCreatedEventDestroyEvent=u.EventProvider.register("System.onUserControlCreated",o.__onUserControlCreated()),o.__onUserControlRemovedEventDestroyEvent=u.EventProvider.register("System.onUserControlRemoved",o.__onUserControlRemoved())),o}t=u.Controls||(u.Controls={}),p=t.System||(t.System={}),s=p.TcHmiControl,__extends(r,s),r.prototype.__previnit=function(){if(this.__elementTemplateRoot=this.__element.find(".tchmi-user-control-host-template"),0===this.__elementTemplateRoot.length)throw new Error("Invalid Template.html");this.__processTargetUserControl(),s.prototype.__previnit.call(this)},r.prototype.__init=function(){s.prototype.__init.call(this)},r.prototype.__attach=function(){s.prototype.__attach.call(this)},r.prototype.__detach=function(){s.prototype.__detach.call(this)},r.prototype.destroy=function(){if(this.__elementTemplateRoot&&this.__elementTemplateRoot.empty(),this.__targetUserControlControlObject)try{this.__targetUserControlControlObject.destroy(),this.__targetUserControlControlObject=null}catch(t){u.Log.error("[Source=Control, Module=TcHmi.Controls.System.TcHmiUserControlHost, Id="+this.getId()+"] Unexpected exception="+t+" while destroying existing TargetUserControl isntance.")}!0===TCHMI_ENABLE_DESIGNER_MODE&&(null!==this.__onUserControlChangedEventDestroyEvent&&(this.__onUserControlChangedEventDestroyEvent(),this.__onUserControlChangedEventDestroyEvent=null),null!==this.__onUserControlConfigChangedEventDestroyEvent&&(this.__onUserControlConfigChangedEventDestroyEvent(),this.__onUserControlConfigChangedEventDestroyEvent=null),null!==this.__onUserControlCreatedEventDestroyEvent&&(this.__onUserControlCreatedEventDestroyEvent(),this.__onUserControlCreatedEventDestroyEvent=null),null!==this.__onUserControlRemovedEventDestroyEvent&&(this.__onUserControlRemovedEventDestroyEvent(),this.__onUserControlRemovedEventDestroyEvent=null)),this.__params={},this.__partialDefaultVirtualRights={},s.prototype.destroy.call(this)},r.prototype.__processTargetUserControl=function(){if(this.__elementTemplateRoot&&this.__elementTemplateRoot.empty(),this.__targetUserControlControlObject)try{this.__targetUserControlControlObject.destroy(),this.__targetUserControlControlObject=null}catch(t){u.Log.error("[Source=Control, Module=TcHmi.Controls.System.TcHmiUserControlHost, Id="+this.getId()+", Attribut=TargetUserControl] Unexpected exception="+t+" while destroying existing TargetUserControl isntance.")}var t=this.__params;if(this.__params={},this.__partialDefaultVirtualRights={},this.__config=u.System.Caches.partialCompositeConfigCache.get(this.__targetUserControlConfigUrlClean),this.__markup=u.System.Caches.partialMarkupCache.get(this.__targetUserControlUrlClean),this.__targetUserControlUrl&&this.__targetUserControlUrlClean&&this.__targetUserControlConfigUrl&&this.__targetUserControlConfigUrlClean)if(this.__markup)if(this.__config)if(!1!==this.__isRecursionSave(this.__targetUserControlConfigUrlClean)){var e=this.__config,r=this.__markup,o=$(r);if(void 0!==o&&0!==o.length)if(o[0].getAttribute("data-tchmi-type")===p.TcHmiUserControl.__type)if(o[0].id){var n=o.find("div[data-tchmi-type]"),s={};s[o[0].id]=null;for(var i=0,l=n.length;i<l;i++)s[n[i].id]=null;var a=new u.System.Parser.SymbolExpressionParser(r),_=a.resolveExpressionsBySymbolType(u.SymbolType.PartialParam);if(null!=_)for(i=0,l=_.length;i<l;i++){var h=_[i];r=r.replace(new RegExp(tchmi_escape_regex(""+h.toString()),"g"),"%pp%"+this.__id+"."+h.getContent()+"%/pp%")}var C=a.resolveExpressionsBySymbolType(u.SymbolType.Control);if(null!=C)for(i=0,l=C.length;i<l;i++)h=C[i],s.hasOwnProperty(h.getName())&&(r=r.replace(new RegExp(tchmi_escape_regex(""+h.toString()),"g"),"%ctrl%"+this.__id+"."+h.getContent()+"%/ctrl%"));for(var g in s)r=(r=r.replace(new RegExp(tchmi_escape_regex('"'+g),"g"),'"'+this.__id+"."+g)).replace(new RegExp(tchmi_escape_regex("'"+g),"g"),"'"+this.__id+"."+g);if(o=n=null,void 0!==(o=$(r))&&0!==o.length){if(o[0].setAttribute("data-tchmi-partial-url",tchmi_path(this.__targetUserControlUrl)),e&&void 0!==e.parameters){var c=e.parameters;for(i=0,l=c.length;i<l;i++)this.__registerUserControlParamAttribute(c[i],t?t[c[i].name]:void 0)}if(e&&void 0!==e.virtualRights)for(i=0,l=e.virtualRights.length;i<l;i++)this.__registerVirtualRight(e.virtualRights[i]);this.__targetUserControlControlObject=u.System.Services.controlManager.compile(o,this),void 0!==this.__targetUserControlControlObject&&null!==this.__targetUserControlControlObject?("Content"===this.getWidthMode()&&this.__processWidth(),"Content"===this.getHeightMode()&&this.__processHeight(),this.__elementTemplateRoot.append(this.__targetUserControlControlObject.getElement())):this.__targetUserControlControlObject=null}}else u.Log.error("[Source=Control, Module=TcHmi.Controls.System.TcHmiUserControlHost, Id="+this.getId()+", Attribut=TargetUserControl] Root element of file="+this.__targetUserControlUrl+" is missing required attribute=id.");else u.Log.error("[Source=Control, Module=TcHmi.Controls.System.TcHmiUserControlHost, Id="+this.getId()+", Attribut=TargetUserControl] Wrong type (not tchmi-user-control).")}else u.Log.error("[Source=Control, Module=TcHmi.Controls.System.TcHmiUserControlHost, Id="+this.getId()+", Attribut=TargetUserControl] Loading file="+this.__targetUserControlUrl+" was blocked to avoid recursion!");else u.Log.error("[Source=Control, Module=TcHmi.Controls.System.TcHmiUserControlHost, Id="+this.getId()+", Attribut=TargetUserControl] Required TargetUserControl configuration file="+this.__targetUserControlConfigUrlClean+" is missing.");else u.Log.error("[Source=Control, Module=TcHmi.Controls.System.TcHmiUserControlHost, Id="+this.getId()+", Attribut=TargetUserControl] Required TargetUserControl file="+this.__targetUserControlUrlClean+"Â is missing.")},r.prototype.__registerUserControlParamAttribute=function(r,t){var o=this,e=r.name,n={attrDescr:null,value:null};function s(t,e){tchmi_equal(n.value,t)||(n.value=t,u.EventProvider.raise(o.__id+".onFunctionResultChanged",[r.propertyGetterName],[{propertyName:r.propertyName,dirtyPaths:e}]))}this.__params[e]=n;var i=t||null,l=null;if(void 0!==this.__attrs&&null!==this.__attrs){var a=this.__attrs[r.name];null!=a&&void 0!==a.descr&&null!==a.descr&&void 0!==a.descr.type&&null!==a.descr.type&&null===(l=u.ValueConverter.toType(a.value,a.descr.type))&&(l=a.value)}if(void 0===(n.attrDescr=r).defaultValueInternal){var _=u.Type.getSchema(r.type);_&&(n.value=u.Type.Schema.resolveDefault(_))}else n.value=r.defaultValueInternal;this[r.propertySetterName]=s,this[r.propertyGetterName]=function(){return n.value},i?s(i.value):null!=l&&!1===u.Symbol.isSymbolExpression(l)&&s(l)},r.prototype.__registerVirtualRight=function(t){!0!==t.defaultValueInternal&&!1!==t.defaultValueInternal||(this.__partialDefaultVirtualRights[t.name]=t)},r.prototype.__isRecursionSave=function(t){for(var e=this.__parent;null!==e;){if("tchmi-user-control-host"===e.getType()&&void 0!==e.getTargetUserControl&&tchmi_path(e.getTargetUserControl())===t)return!1;e=e.getParent()}return!0},r.prototype.__refreshTargetPartial=function(){this.__isDestroyed||this.__processTargetUserControl()},r.prototype.__onUserControlChanged=function(){var r=this;return function(t,e){e.url&&e.url===r.__targetUserControlUrlClean&&e.content&&r.__markup&&e.content!==r.__markup&&r.__refreshTargetPartial()}},r.prototype.__onUserControlConfigChanged=function(){var r=this;return function(t,e){e.url&&e.url===r.__targetUserControlConfigUrlClean&&r.__refreshTargetPartial()}},r.prototype.__onUserControlCreated=function(){var r=this;return function(t,e){e.url&&e.url===r.__targetUserControlUrlClean&&r.__refreshTargetPartial()}},r.prototype.__onUserControlRemoved=function(){var r=this;return function(t,e){e.url&&e.url===r.__targetUserControlUrlClean&&r.__refreshTargetPartial()}},r.prototype.getTargetUserControl=function(){return this.__targetUserControlUrl},r.prototype.setIsEnabled=function(t){s.prototype.setIsEnabled.call(this,t)},r.prototype.__processIsEnabled=function(){s.prototype.__processIsEnabled.call(this)},r.prototype.__processAccessConfig=function(){s.prototype.__processAccessConfig.call(this)},r.prototype.setWidthMode=function(t){var e=u.ValueConverter.toSizeModeWithContent(t);null===e&&(e=this.getAttributeDefaultValueInternal("WidthMode")),e!==this.__widthMode&&(this.__widthMode=e,u.EventProvider.raise(this.__id+".onFunctionResultChanged",["getWidthMode"]),this.__processWidthMode())},r.prototype.__processWidth=function(t){if("Content"===this.getWidthMode()){var e="";if(null!==this.__targetUserControlControlObject){var r=this.__targetUserControlControlObject.__getContentWidth();null!==r&&(e=r+"px"),t&&this.__targetUserControlControlObject===t||"Content"!==this.__targetUserControlControlObject.getWidthMode()||this.__targetUserControlControlObject.__processWidth(this)}u.StyleProvider.setSimpleElementStyle(this.__element,"width",e)}s.prototype.__processWidth.call(this,t)},r.prototype.setHeightMode=function(t){var e=u.ValueConverter.toSizeModeWithContent(t);null===e&&(e=this.getAttributeDefaultValueInternal("HeightMode")),e!==this.__heightMode&&(this.__heightMode=e,u.EventProvider.raise(this.__id+".onFunctionResultChanged",["getHeightMode"]),this.__processHeightMode())},r.prototype.__processHeight=function(t){if("Content"===this.getHeightMode()&&(this.__intHeight=null)!==this.__targetUserControlControlObject){var e=this.__targetUserControlControlObject.__getContentHeight();null!==e&&(this.__intHeight=e+"px"),t&&this.__targetUserControlControlObject===t||"Content"!==this.__targetUserControlControlObject.getHeightMode()||this.__targetUserControlControlObject.__processHeight(this)}s.prototype.__processHeight.call(this,t)},r.prototype.__getContentWidth=function(){return"Content"!==this.getWidthMode()?s.prototype.__getContentWidth.call(this):"Collapsed"!==this.__visibility&&null!==this.__targetUserControlControlObject?this.__targetUserControlControlObject.__getContentWidth():null},r.prototype.__getContentHeight=function(){return"Content"!==this.getHeightMode()?s.prototype.__getContentHeight.call(this):"Collapsed"!==this.__visibility&&null!==this.__targetUserControlControlObject?this.__targetUserControlControlObject.__getContentHeight():null},r.prototype.getDescriptionAccessByName=function(t){return t&&this.__partialDefaultVirtualRights[t]?this.__partialDefaultVirtualRights[t]:null},e=r,p.TcHmiUserControlHost=e,t.register("tchmi-user-control-host",u.Controls.System.TcHmiUserControlHost,"System/TcHmiUserControlHost/","System/TcHmiUserControlHost/Template.html")}(TcHmi=TcHmi||{});